<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:bnu="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">

    <h:body>
        <ui:composition template="../../../template/template.xhtml">

            <ui:define name="content">
                <h:form id="CustomerDetailForm" >
                    <bnu:row>
                        <bnu:column span="4" >
                            <h3> #{customerDetailController.currentCust.displayName}</h3>
                            <p  style="color: grey;" >#{customerDetailController.currentCust.company} | #{customerDetailController.currentCust.city}, #{customerDetailController.currentCust.country}</p>
                        </bnu:column>
                        <bnu:column span="5" />
                        <bnu:column span="3" >
                            <h3> <bnu:button value="Edit" onclick="$('.editCustModal').modal();" />

                                <bnu:dropButton value="#{messages.lblNewTrans}" style="margin-left: 1em;" look="success"  >
                                    <bnu:commandButton value="#{messages.lblInvoiceTypeIn}"  action="#{customerDetailController.setType('IN' )}" style="width: 100%; border: none" />
                                    <bnu:commandButton value="#{messages.lblPayment}"   style="width: 100%; border: none" action="#{customerDetailController.pagar()}" />
                                    <bnu:commandButton value="#{messages.lblEstimate}"  action="#{customerDetailController.setType('ES')}" style="width: 100%; border: none" />
                                    <bnu:commandButton value="#{messages.salesR}"  action="#{customerDetailController.setType('SR')}" style="width: 100%; border: none" />

                                </bnu:dropButton> </h3>

                        </bnu:column>
                    </bnu:row>
                    <bnu:row>
                        <bnu:column span="10" />
                        <bnu:column span="2" >
                            <table>
                                <tr>
                                    <td style="background-color: yellow;width: 0.50em" rowspan="2" >

                                    </td>
                                    <td style="padding-left:  0.50em" >
                                        <h4>#{userData.formatMaster(customerDetailController.DOpenBalance)}</h4> 
                                    </td>

                                </tr>
                                <tr>
                                    <td style="padding-left: 0.50em" >
                                        <p style="color: grey;" >OPEN</p>
                                    </td>
                                </tr>

                            </table>
                            <br/>
                            <table>
                                <tr>
                                    <td style="background-color: red;width: 0.50em" rowspan="2"  >

                                    </td>
                                    <td style="padding-left: 0.50em" >
                                        <h4>#{userData.formatMaster(customerDetailController.DOverDue)}</h4>
                                    </td>

                                </tr>
                                <tr>
                                    <td style="padding-left: 0.50em" >
                                        <p style="color: grey;" >OVERDUE</p>
                                    </td>

                                </tr>
                            </table>





                        </bnu:column>


                    </bnu:row>
                    <bnu:row>
                        <bnu:column span="12">
                            <bnu:messages id="messages" />
                        </bnu:column>
                    </bnu:row>

                    <bnu:tabView active-index="0" > 
                        <bnu:tab title="#{messages.lblTransactionList}">



                            <bnu:dataTable
                                value="#{customerDetailController.transactionList}"
                                id="tblInvoice"
                                var="in"
                                responsive="true"


                                >
                                <bnu:dataTableColumn  >
                                    <f:facet name="header">
                                        <bnu:selectBooleanCheckbox  />
                                    </f:facet>
                                    <bnu:selectBooleanCheckbox  value="#{in.checkbox}"  />
                                </bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceDate}" value="#{in.inDate}"   />
                                <bnu:dataTableColumn  label="#{messages.lblType}" value="#{userData.formatType(in.type)}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn   label="#{messages.lblInvoiceNo}"  value="#{in.noDot}" ></bnu:dataTableColumn>

                                <bnu:dataTableColumn label="#{messages.lblIncoiceDueDate}" value="#{in.dueDate}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceBalance}" value="#{userData.formatMaster(in.actualBalance.toString())}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceTotalBTax}" value="#{userData.formatMaster(in.subTotal.toString())}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceTax}" value="#{userData.formatMaster(in.taxTotal.toString())}"  ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceTotal}"  value="#{userData.formatMaster(in.total.toString())}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblInvoiceStatus}" value="#{userData.formatStatus(in.status)}" ></bnu:dataTableColumn>
                                <bnu:dataTableColumn label="#{messages.lblAction}">

                                    <bnu:dropButton value="#{messages.edit}" look="primary" styleClass="hidden-xs hidden-sm" >
                                        <bnu:commandButton value="#{messages.edit}"  style="width:100%; border: none" action="#{customerDetailController.edit(in)}" rendered="#{userData.showOptions(in.status,in.type,'EDIT')}"  />

                                        <bnu:commandButton value="#{messages.lblInvoicePrint}"  style="width:100%; border: none"  update="pdf" action="#{customerDetailController.print(in,request)}"
                                                           rendered="#{userData.showOptions(in.status,in.type,'PRINT')}"  />

                                        <bnu:commandButton value="Update status"  style="width:100%; border: none"  
                                                           rendered="#{userData.showOptions(in.status,in.type,'ESTATUS')}" action="#{customerDetailController.assignEstimate(in)}"   />

                                        <bnu:commandButton value="Copy"  style="width:100%; border: none"  
                                                           rendered="#{userData.showOptions(in.status,in.type,'COPY')}" action="#{customerDetailController.copy(in)}"   />

                                        <bnu:commandButton value="Receive Payment"  style="width:100%; border: none"  
                                                           rendered="#{userData.showOptions(in.status,in.type,'REPAY')}" action="#{customerDetailController.recievePayment(in.idCust.idCust.toString(), in.idInvoice.toString())}"   />

                                    </bnu:dropButton>
                                    <bnu:commandButton value="#{messages.edit}"  look="warning" styleClass="hidden-lg hidden-md" action="#{customerDetailController.edit(in)}" rendered="#{userData.showOptions(in.status,in.type,'EDIT')}"   />

                                    <bnu:commandButton value="Update status"  style="width:100%; border: none"   styleClass="hidden-lg hidden-md"
                                                       rendered="#{userData.showOptions(in.status,in.type,'ESTATUS')}" action="#{customerDetailController.assignEstimate(in)}"   />

                                    <bnu:commandButton value="#{messages.lblInvoicePrint}" update="pdf"  styleClass="hidden-lg hidden-md"  action="#{customerDetailController.print(in,request)}" rendered="#{userData.showOptions(in.status,in.type,'PRINT')}"  />

                                    <bnu:commandButton value="Copy"  style="width:100%; border: none" styleClass="hidden-lg hidden-md" 
                                                       rendered="#{userData.showOptions(in.status,in.type,'COPY')}" action="#{customerDetailController.copy(in)}"   />
                                    <bnu:commandButton value="Receive Payment"  style="width:100%; border: none"  styleClass="hidden-lg hidden-md"
                                                       rendered="#{userData.showOptions(in.status,in.type,'REPAY')}" action="#{customerDetailController.recievePayment(in.idCust.idCust.toString(), in.idInvoice.toString())}"   />
                                </bnu:dataTableColumn>

                            </bnu:dataTable>



                        </bnu:tab>
                        <bnu:tab title="#{messages.lblCustomerDetails}">



                            <!-- cust data -->
                            <br/>
                            <br/>
                            <bnu:column col-lg="6" col-md="6" col-sm="12" col-xs="12" >
                                <table class="table table-hover">

                                    <tbody>
                                        <tr>
                                            <td><strong>#{messages.lblCustomerFU}</strong></td>
                                            <td>#{customerDetailController.currentCust.displayName}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblEmailCustomerFU}</strong></td>
                                            <td>#{customerDetailController.currentCust.email}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.phoneC}</strong></td>
                                            <td>#{customerDetailController.currentCust.phone}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.mobileC}</strong></td>
                                            <td>#{customerDetailController.currentCust.mobile}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.faxC}</strong></td>
                                            <td>#{customerDetailController.currentCust.fax}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.websiteC}</strong></td>
                                            <td>#{customerDetailController.currentCust.webside}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblCustNotes}</strong></td>
                                            <td><input type="text" placeholder="#{messages.lblAddNotes}" disabled="disabled" value="#{customerDetailController.currentCust.note}" /></td>

                                        </tr>
                                    </tbody>
                                </table>
                            </bnu:column>
                            <bnu:column col-lg="6" col-md="6" col-sm="12" col-xs="12" >
                                <table class="table table-hover">

                                    <tbody>
                                        <tr>
                                            <td><strong>#{messages.billingA}</strong></td>
                                            <td>#{customerDetailController.currentCust.city},#{customerDetailController.currentCust.country}</td>

                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.shippingA}</strong></td>
                                            <td>#{customerDetailController.currentCust.cityS},#{customerDetailController.currentCust.countryS}</td>


                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblInvoiceTerms}</strong></td>
                                            <td>#{customerDetailController.currentCust.terms}</td>


                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblPaymentMethod}</strong></td>
                                            <td>#{customerDetailController.currentCust.paymentMethod}</td>


                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblPrefDelivery}</strong></td>
                                            <td>#{customerDetailController.currentCust.deliveryMethod}</td>


                                        </tr>
                                        <tr>
                                            <td><strong>#{messages.lblTaxRegNo}</strong></td>
                                            <td>#{customerDetailController.currentCust.taxregno}</td>


                                        </tr>
                                    </tbody>
                                </table>
                            </bnu:column>



                        </bnu:tab>

                    </bnu:tabView>


                </h:form>


                <bnu:modal  id="invoiceModal" title="#{messages.invoice}" styleClass="invoiceModal"  close-on-escape="false" backdrop="false"  >
                    <h:panelGroup id="pdf">

                        <p:media value="#{customerDetailController.invoiceModal}" width="100%" height="500px" rendered="#{not(customerDetailController.invoiceModal eq '0')}"  />     


                    </h:panelGroup>
                </bnu:modal> 


                <bnu:modal  id="updateStatusModal" title="#{messages.lblEstimate}" styleClass="updateStatusModal"   >

                    <h:form  >
                        <bnu:selectOneMenu label="#{messages.lblInvoiceStatus}" value="#{customerDetailController.estimateStatus}" onchange="show(this.value);" >

                            <f:selectItem itemValue="PE" itemLabel="#{messages.lblESPending}" />
                            <f:selectItem itemValue="AC" itemLabel="#{messages.lblAccepted}" />
                            <f:selectItem itemValue="CL" itemLabel="#{messages.lblClosed}" />
                            <f:selectItem itemValue="RJ" itemLabel="#{messages.lblRejected}" />
                        </bnu:selectOneMenu>
                        <div class="updateEstimateStatus" style="display: none;" >
                            <bnu:inputText label="By" maxlength="30"  value="#{customerDetailController.accBy}" />
                            <strong>
                                <h:outputText value="Date"  />

                            </strong>
                            <bnu:datepicker value="#{customerDetailController.accDate}"    />
                        </div>
                        <p:separator/>

                        <bnu:commandButton value="Cancel" style="margin-right: 10px;" />
                        <bnu:commandButton value="Ok" look="success"  action="#{customerDetailController.updateEstimateStatus()}" />

                    </h:form>

                </bnu:modal>
                
                
                
                
                  <h:form id="customerFormEdit" >
                    <bnu:modal id="amodal2" styleClass="editCustModal" size="modal-lg" title="Customer information" >
                        <bnu:row>
                            <bnu:column span="1" >
                                <label>#{messages.titleC}</label>
                                <bnu:inputText type="text" size="3" value="#{customerDetailController.currentCust.title}"  class="title" name="title" onblur="customerFormHelper.displayName();"  />
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.fNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{customerDetailController.currentCust.firstname}" class="fname" name="fname"  onblur="customerFormHelper.displayName();"  />
                                
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.midNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{customerDetailController.currentCust.middlename}" class="mname" name="mname" onblur="customerFormHelper.displayName();"   />
                                
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.lastNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{customerDetailController.currentCust.lastname}" class="lname" name="lname" onblur="customerFormHelper.displayName();"   />
                                
                            </bnu:column>
                            <bnu:column span="1" >
                                <label>#{messages.suffixC}</label>
                                <bnu:inputText type="text" size="3" value="#{customerDetailController.currentCust.suffixx}" class="suffix" name="suffix" onblur="customerFormHelper.displayName();"   />
                                
                            </bnu:column>
                            <bnu:column span="4" >
                                <bnu:inputText label="#{messages.email}" value="#{customerDetailController.currentCust.email}" field-size="xs" />

                            </bnu:column>
                        </bnu:row>

                        <bnu:row>

                            <bnu:column span="6" >
                                <bnu:inputText label="#{messages.companyC}" value="#{customerDetailController.currentCust.company}" field-size="xs" />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.phoneC}" value="#{customerDetailController.currentCust.phone}" field-size="xs" />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.mobileC}" value="#{customerDetailController.currentCust.mobile}" field-size="xs" />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.faxC}" value="#{customerDetailController.currentCust.fax}" field-size="xs" />

                            </bnu:column>
                        </bnu:row>

                        <bnu:row>


                            <bnu:column span="6" >
                                <label>#{messages.displayN}</label>
                                <bnu:inputText type="text" class="displayName"  field-size="xs" value="#{customerDetailController.currentCust.displayName}" />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.Otros}" field-size="xs"   />
                            </bnu:column>
                            <bnu:column span="4" >
                                <bnu:inputText label="#{messages.website}" field-size="xs" value="#{customerDetailController.currentCust.webside}" />

                            </bnu:column>
                        </bnu:row>


                        <bnu:tabView  activeIndex="0" >
                            <bnu:tab title="#{messages.lblAddress}" >
                                <bnu:row>
                                    <bnu:column span="6" >
                                        <bnu:row>
                                            <bnu:column span="12">
                                                <label>#{messages.billingA}</label>
                                                <bnu:inputTextarea  placeholder="#{messages.streetC}" class="form-control"  value="#{customerDetailController.currentCust.street}" />
                                            </bnu:column>
                                        </bnu:row>

                                        <bnu:row>
                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.cityT}"  value="#{customerDetailController.currentCust.city}" />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.stateP}"  value="#{customerDetailController.currentCust.estate}" />
                                            </bnu:column>

                                        </bnu:row>

                                        <bnu:row>
                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.postalCC}"  value="#{customerDetailController.currentCust.postalCode}" />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.countryC}" value="#{customerDetailController.currentCust.country}" />
                                            </bnu:column>

                                        </bnu:row>

                                    </bnu:column>
                               
                                    <bnu:column span="6" >
                                        <bnu:row>
                                            <bnu:column span="12">
                                                <label>#{messages.shippingA}</label> <input checked="true" type="checkbox" onclick="customerFormHelper.enableShipAdress()" value="1"  name="sameSha" id="sameSha" />#{messages.sameSHA}
                                                <bnu:inputTextarea placeholder="#{messages.streetC}"  class="form-control shippingEnable"  value="#{customerDetailController.currentCust.streetS}"   />
                                            </bnu:column>
                                        </bnu:row>
                                        <bnu:row>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.cityT}"  class="shippingEnable" value="#{customerDetailController.currentCust.cityS}" />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.stateP}"  class="shippingEnable" value="#{customerDetailController.currentCust.estateS}" />
                                            </bnu:column>
                                        </bnu:row>
                                        <bnu:row>

                                    <bnu:column span="6">
                                        <bnu:inputText placeholder="#{messages.postalCC}"  class="shippingEnable" value="#{customerDetailController.currentCust.postalCodeS}" />
                                    </bnu:column>

                                    <bnu:column span="6">
                                        <bnu:inputText placeholder="#{messages.countryC}"  class="shippingEnable" value="#{customerDetailController.currentCust.countryS}" />
                                    </bnu:column>
                                </bnu:row>
                                    </bnu:column>

                                
                                

                                </bnu:row>


                            </bnu:tab>
                            <bnu:tab title="#{messages.lblCustNotes }" >
                                <bnu:row>
                                    <bnu:column span="12">
                                        <bnu:inputTextarea label="#{messages.lblCustNotes }"  value="#{customerDetailController.currentCust.note}" />
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.taxInfo}" >
                                <bnu:row>
                                    <bnu:column span="4">
                                        <bnu:inputText label="#{messages.lblTaxRegNo}"  value="#{customerDetailController.currentCust.taxregno}" />
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.lblPaymentAndBilling}" >
                                <bnu:row>
                                    <bnu:column span="4">
                                        <bnu:selectOneMenu label="#{messages.lblPreferredPayment}" value="#{customerDetailController.currentCust.paymentMethod}" >
                                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue=""  />
                                            <f:selectItems value="#{customerDetailController.PMethodList}" var="pm"
                                           itemValue="#{pm.display}" itemLabel="#{pm.display}" />   
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                    <bnu:column span="4"></bnu:column>
                                    <bnu:column span="4">
                                        <bnu:selectOneMenu label="#{messages.lblInvoiceTerms}"    value="#{customerDetailController.currentCust.terms}" >
                                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                                            <f:selectItems value="#{customerDetailController.TList}" var="term"
                                               itemLabel="#{term.display}" itemValue="#{term.days}" />
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                </bnu:row>
                                <bnu:row>
                                    <bnu:column span="4">
                                        <bnu:selectOneMenu label="#{messages.lblPrefDelivery}" value="#{customerDetailController.currentCust.deliveryMethod}" >
                                            <f:selectItem  itemLabel="#{messages.lblNone}" itemValue="#{messages.lblNone}"  />
                                            <f:selectItem  itemLabel="#{messages.lblSendLater}" itemValue="#{messages.lblSendLater}"  />
                                            <f:selectItem  itemLabel="#{messages.lblPrintLater}" itemValue="#{messages.lblPrintLater}"  />
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                    <bnu:column span="2"></bnu:column>
                                    <bnu:column span="2">
                                        <bnu:inputText  label="#{messages.lblOpeningBalance}"  value="#{customerDetailController.currentCust.balance}" disabled="true" />
                                    </bnu:column>
                                    <bnu:column span="4"> <label>#{messages.lblAsOf}</label><bnu:inputText type="date" disabled="true" value="#{customerDetailController.currentCust.asOf}"  /></bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.lblAttachments}" >
                                <bnu:row>
                                    <bnu:column  span="4">
                                        <p:fileUpload />
                                    </bnu:column>
                                    <bnu:column  span="4">
                                        #{messages.lblMaximumSize}
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>


                        </bnu:tabView>
                        <bnu:row>
                            <bnu:column span="12">
                                <bnu:messages id="errorMessage"/>
                            </bnu:column>
                        </bnu:row>

                        <f:facet name="footer">
                            <bnu:button value="Close" dismiss="modal"  />
                            <bnu:commandButton value="Save" look="success" update="customerFormEdit:errorMessage" action="#{customerDetailController.editCustomer()}" />
                        </f:facet>
                    </bnu:modal>
                </h:form>

                
                
                
                 <h:outputScript>
      
                    
                    var customerFormHelper = {
                    shippingDir : 1,
                    displayName: function(){
                    var title = $(".title").val() + ' ';
                    var fname = $(".fname").val() + ' ';
                    var mname = $(".mname").val() + ' ';
                    var lname = $(".lname").val() + ' ';
                    var suffix = $(".suffix").val();
                    $(".displayName").val(title + fname +mname + lname + suffix);
                    },
                    enableShipAdress: function (){
                    if(this.shippingDir == 1){
                    $(".shippingEnable").removeAttr('disabled');

                    this.shippingDir = 2;
                    }else{
                    $(".shippingEnable").attr('disabled',true);
                    $(".shippingEnable").val("");
                    this.shippingDir = 1;
                    }
                    }
                    };
                    

                    $(document).ready(function(){
                        $(".shippingEnable").attr('disabled',true);
                        
                    });
                    
                </h:outputScript>
                


            </ui:define>
        </ui:composition>
    </h:body>
</html>

