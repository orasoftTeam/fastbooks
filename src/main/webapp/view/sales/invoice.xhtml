<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://java.sun.com/jsf/html"
             xmlns:ui="http://java.sun.com/jsf/facelets"
             xmlns:f="http://java.sun.com/jsf/core"
             xmlns:bnu="http://bootsfaces.net/ui"
             xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
             xmlns:p="http://primefaces.org/ui">

    <ui:remove>
        <!--
                    Hint to editors: The menus follow the Chicago style of capitalization. Please capitalize everything but the "smaller" words. 
        -->
    </ui:remove>

    <bnu:form id="tblInvoiceForm" inline="true">
        #{invoiceTableController.showAlert()}

        <bnu:row>
            <bnu:column large-screen="10" medium-screen="11" small-screen="12" tiny-screen="12" >
                <h2>#{messages.lblSalesTrans}</h2>
            </bnu:column>
            <bnu:column large-screen="2" medium-screen="1" small-screen="12" tiny-screen="12">
                <bnu:dropButton value="#{messages.lblNewTrans}"  look="success" style="margin-top:20px;" >
                    <bnu:commandButton value="#{messages.lblInvoiceTypeIn}"  action="#{invoiceTableController.setType('IN','/view/sales/invoiceForm.xhtml' )}" style="width: 100%; border: none" />
                    <bnu:commandButton value="#{messages.lblPayment}"   style="width: 100%; border: none" action="#{invoiceController.pagar()}" />
                    <bnu:commandButton value="#{messages.lblEstimate}"  action="#{invoiceTableController.setType('ES','/view/sales/invoiceForm.xhtml' )}" style="width: 100%; border: none" />
                    <bnu:commandButton value="#{messages.salesR}"  action="#{invoiceTableController.setType('SR','/view/sales/invoiceForm.xhtml' )}" style="width: 100%; border: none" />
                    <!-- 
     <bnu:navLink value="#{messages.lblPayment}" href="#{request.contextPath}/view/sales/payments/receivePayment.xhtml" ></bnu:navLink>
  
   <bnu:navLink value="Sales Receipt"></bnu:navLink>
   <bnu:navLink value="Credit Note"></bnu:navLink>
   <bnu:navLink value="Delayed Charged"></bnu:navLink>
   <bnu:navLink value="Time Activity"></bnu:navLink>-->
                </bnu:dropButton> 
            </bnu:column>
        </bnu:row>


        <bnu:row id="panelVentas" styleClass="hidden-xs hidden-sm" >
            <bnu:column span="12">
                <div class="table moneyBar" >
                    <div class="tableRow" >
                        <div class="tableCell unbilled_tab" >
                            <div class="bucket unbilled_tab">
                                <div class="header">Unbilled Last 365 Days</div>
                                <div class="table">
                                    <div class="tableRow" >
                                        <div class="tableCell">
                                            <div class="box estimates" id="estimates" onmouseover="hoverBox('estimates')" onmouseout="hoverBoxOut('estimates')" onclick="redirectPanel(0);" >
                                                <div class="subbox">
                                                    <span class="amount" >#{userData.formatMaster(invoiceTableController.panelVentas.totalEstimates)}</span>&nbsp;
                                                    <div><span >#{invoiceTableController.panelVentas.noEstimates}&nbsp;</span><span >ESTIMATES</span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tableCell">
                                            <div class="box ccbt"  id="unbilled"  onmouseover="hoverBox('unbilled')" onmouseout="hoverBoxOut('unbilled')" onclick="redirectPanel(1);" >
                                                <div class="subbox">
                                                    <span class="amount" >#{userData.formatMaster(invoiceTableController.panelVentas.totalUnbilled)}</span>&nbsp;
                                                    <div><span >#{invoiceTableController.panelVentas.noUnbilled}&nbsp;</span><span >UNBILLED ACTIVITY</span></div>
                                                </div>
                                            </div>
                                        </div>


                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="tableCell unpaid_tab">
                            <div class="bucket unpaid_tab"  >
                                <div class="header" >Unpaid Last 365 Days</div>
                                <div class="table">
                                    <div class="tableRow">
                                        <div class="tableCell">
                                            <div class="box unpaid"  id="unpaid" >
                                                <div class="subbox" onmouseover="hoverBox('unpaid')" onmouseout="hoverBoxOut('unpaid')" onclick="redirectPanel(3);" >
                                                    <span class="amount" >#{userData.formatMaster(invoiceTableController.panelVentas.totalOpen)}</span>&nbsp;
                                                    <div><span >#{invoiceTableController.panelVentas.noOpen}&nbsp;</span><span >Open Invoices</span></div>
                                                </div>
                                                <div class="subStatuses">
                                                    <div class="box overdue"  id="overdue" onmouseover="hoverBox('overdue')" onmouseout="hoverBoxOut('overdue')" onclick="redirectPanel(2);" >
                                                        <div class="subbox">
                                                            <span class="amount" >#{userData.formatMaster(invoiceTableController.panelVentas.totalOverdue)}</span>&nbsp;
                                                            <div><span >#{invoiceTableController.panelVentas.noOverdue}&nbsp;</span><span >OVERDUE</span></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tableCell paid_tab">
                            <div class="bucket paid_tab" >
                                <div class="header" >Paid</div>
                                <div class="table">
                                    <div class="tableRow" >
                                        <div class="tableCell">
                                            <div class="box paid"  id="paid" onmouseover="hoverBox('paid')" onmouseout="hoverBoxOut('paid')" onclick="redirectPanel(4);" >
                                                <div class="subbox">
                                                    <span class="amount" >#{userData.formatMaster(invoiceTableController.panelVentas.totalPaid)}</span>&nbsp;
                                                    <div><span >#{invoiceTableController.panelVentas.noPaid}&nbsp;</span><span >PAID LAST 30 DAYS</span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>


                </div>
            </bnu:column>

        </bnu:row>

        <bnu:row>
            <bnu:column span="12">
                <bnu:messages id="messages" />
            </bnu:column>
        </bnu:row>
        <p:separator/>
        <bnu:row >
            <bnu:column span="5">
                <div class="dropdown">
                    <bnu:button onclick="myFunction()" value="#{messages.lblFilter}" style="margin-bottom: 15px"  class="dropLi" iconAwesome="fa-angle-down" icon-align="right" />
                    <div id="myDropdown" class="dropdown-content dropLi">

                        <bnu:selectOneMenu label="#{messages.lblType}" style="width: 150px;margin: 10px" value="#{invoiceTableController.FType}" onchange="filterHelper.changeType(this.value);" class="comboType" >
                            <f:selectItem itemValue="0" itemLabel="#{messages.lblAllTransactions}"  />
                            <f:selectItem itemLabel="#{messages.invoice}" itemValue="IN" />
                            <f:selectItem itemLabel="#{messages.lblEstimate}" itemValue="ES" />
                            <f:selectItem itemLabel="#{messages.salesR}" itemValue="SR" />
                            <f:selectItem itemLabel="#{messages.lblPayment}" itemValue="PA" />
                            <f:selectItem itemLabel="#{messages.lblStatement}" itemValue="ST" />
                            <!--<f:selectItem itemLabel="Tres"/>-->
                        </bnu:selectOneMenu><br></br>
                        <div  class="hideStZone" >
                        <bnu:selectOneMenu label="#{messages.lblInvoiceStatus}" style="width: 150px;margin: 10px"  value="#{invoiceTableController.FStatus}"
                                           class="statuses"  onchange="filterHelper.changeStatus(this.value);" >
                            <f:selectItem itemValue="0" itemLabel="#{messages.lblAllStatuses}"  />
                            <!-- invoice status -->
                            <f:selectItem itemLabel="#{messages.lblInvoiceStatusOpen}"  itemValue="OP" class="invoice" />
                            <f:selectItem itemLabel="#{messages.lblInvoiceStatusOverdue}" itemValue="OV"  class="invoice" />
                            <f:selectItem itemLabel="#{messages.lblPaid}" itemValue="PD" class="invoice" />
                            <f:selectItem itemLabel="#{messages.lblInvoiceStatusPartial}" itemValue="PA" class="invoice" />
                            <!-- estimate status -->
                            <f:selectItem itemLabel="#{messages.lblESPending}" itemValue="PE"   />
                            <f:selectItem itemLabel="#{messages.lblAccepted }" itemValue="AC" />
                            <f:selectItem itemLabel="#{messages.lblRejected}" itemValue="RJ" />

                            <!-- payment status -->
                            <f:selectItem itemLabel="#{messages.lblInvoiceStatusClosed}" itemValue="CL" />
                            <f:selectItem itemLabel="#{messages.lblUnapplied}" itemValue="UN" />






                        </bnu:selectOneMenu>

                        <bnu:inputText label="#{messages.lblInvoiceShipVia}" style="width: 150px;margin: 10px"  value="#{invoiceTableController.FShiVia}"   />
                        
                        <br></br>
                        </div>
                        <bnu:selectOneMenu label="#{messages.lblInvoiceDate}" style="width: 150px;margin: 10px" value="#{invoiceTableController.FDate}" class="filterDate"
                                           onchange="filterHelper.changeDate(this.value);" >

                            <f:selectItem itemLabel="#{messages.lblLast365Days}" itemValue="L3" />
                            <f:selectItem itemLabel="#{messages.lblCustom}" itemValue="CU" />
                            <f:selectItem itemLabel="#{messages.lblToday}"  itemValue="TO"/>
                            <f:selectItem itemLabel="#{messages.lblYesterday}" itemValue="YE" />
                            <f:selectItem itemLabel="#{messages.lblThisWeek}" itemValue="TW" />
                            <f:selectItem itemLabel="#{messages.lblThisMonth}" itemValue="TM" />
                            <f:selectItem itemLabel="#{messages.lblThisQuarter}" itemValue="TQ" />
                            <f:selectItem itemLabel="#{messages.lblThisYear}" itemValue="TY" />
                            <f:selectItem itemLabel="#{messages.lblLastWeek}" itemValue="LW" />
                            <f:selectItem itemLabel="#{messages.lblLastMonth}" itemValue="LM" />
                            <f:selectItem itemLabel="#{messages.lblLastQuarter}" itemValue="LQ" />
                            <f:selectItem itemLabel="#{messages.lblLastYear}" itemValue="LY" />
                            <f:selectItem itemLabel="#{messages.lblAllDates}" itemValue="AD" />
                        </bnu:selectOneMenu>
                        <bnu:inputText label="#{messages.lblFrom}"  class="ffrom" style="width: 115px;margin: 10px;" value="#{invoiceTableController.FFrom}" placeholder="mm/dd/yyyy" onblur="soloDate('ffrom')" onkeydown="$('.filterDate').val('CU');" onkeyup="soloDateVal('ffrom');" />
                        <bnu:inputText label="#{messages.lblTo}"  class="fto" style="width: 115px;margin: 10px" value="#{invoiceTableController.FTo}"   placeholder="mm/dd/yyyy"  onblur="soloDate('fto')" onkeydown="$('.filterDate').val('CU');"  onkeyup="soloDateVal('fto');" />
                        <br></br>
                        <bnu:selectOneMenu label="#{messages.lblCustomer}"  style="width: 150px;margin: 10px" value="#{invoiceTableController.FIdCust}" >
                            <f:selectItem itemValue="0" itemLabel="#{messages.lblAll}"  />
                            <f:selectItems value="#{invoiceTableController.CList}" var="cust" itemValue="#{cust.idCust}" itemLabel="#{cust.displayName}"/>
                        </bnu:selectOneMenu><br></br>
                        <bnu:commandButton value="#{messages.lblApply}"  style="margin: 10px" look="success" action="#{invoiceTableController.processFilter()}" /> 
                        <bnu:commandButton style="margin: 10px" value="#{messages.lblReset}" look="danger" action="#{invoiceTableController.resetFilterBtn()}"  /> 

                    </div>
                </div>
            </bnu:column>
            <bnu:column span="3" rendered="#{invoiceTableController.hasPanelFilter}" >
                <a href="#{request.contextPath}/view/sales/sales.xhtml" >Reset filters</a>
            </bnu:column>
        </bnu:row>
        <bnu:row  >
            <bnu:column span="12">


                <bnu:iconAwesome name="fa-long-arrow-down" size="2x"  style="margin-right: 15px" />

                <bnu:dropButton value="#{messages.lblBatchOptions}" style="margin-bottom:15px" class="batchOptions"  >
                    <bnu:commandButton value="#{messages.lblPrintTranc}" style="width: 100%;border: none" class="cPrintTrans"   action="#{invoiceTableController.printTransactions()}" update="@(.pdfInvoices)"   ></bnu:commandButton>
                    <bnu:commandButton value="#{messages.lblPrintPackingSlip}"  style="width: 100%;border: none"   class="cPrintPacking"  action="#{invoiceTableController.packingSlip()}" update="@(.pdfInvoices)"  ></bnu:commandButton>

                    <!--<bnu:navLink value="#{messages.lblSendTranc}" href="#"></bnu:navLink>
                    <bnu:navLink value="#{messages.lblSendRemind}" ></bnu:navLink>-->
                </bnu:dropButton>

            </bnu:column>
        </bnu:row>

        <bnu:row>
            <bnu:column span="12">
                <bnu:dataTable
                    rendered="#{invoiceTableController.IList.size() > 0}"
                    value="#{invoiceTableController.IList}"
                    id="tblInvoice"
                    var="in"
                    


                    >
                    <bnu:dataTableColumn  >
                                    <f:facet name="header">
                                        <bnu:selectBooleanCheckbox  />
                                    </f:facet>
                        <bnu:selectBooleanCheckbox  value="#{in.checkbox}"  onclick="batchHelper.activateOption('#{in.type}','#{in.idInvoice}');"   />
                                </bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceDate}"    >
                       #{in.inDate}
                    </bnu:dataTableColumn>
                    <bnu:dataTableColumn  label="#{messages.lblType}" value="#{invoiceTableController.formatType(in.type)}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn   label="#{messages.lblInvoiceNo}"  value="#{in.noDot}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvocieCustomer }" value="#{in.idCust.displayName}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblIncoiceDueDate}" value="#{in.dueDate}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceBalance}" value="#{userData.formatMaster(in.actualBalance.toString())}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceTotalBTax}" value="#{userData.formatMaster(in.subTotal.toString())}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceTax}" value="#{userData.formatMaster(in.taxTotal.toString())}"  ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceTotal}"  value="#{userData.formatMaster(in.total.toString())}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvoiceStatus}" value="#{invoiceTableController.formatStatus(in.status)}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblAction}">

                        <bnu:dropButton value="#{messages.edit}" look="primary" styleClass="hidden-xs hidden-sm" >
                            <bnu:commandButton value="#{messages.edit}"  style="width:100%; border: none" action="#{invoiceTableController.edit(in)}" rendered="#{invoiceTableController.showOptions(in.status,in.type,'EDIT')}"  />

                            <bnu:commandButton value="#{messages.lblInvoicePrint}"  style="width:100%; border: none"  update="pdf" action="#{invoiceTableController.print(in,request)}"
                                               rendered="#{invoiceTableController.showOptions(in.status,in.type,'PRINT')}"  />

                            <bnu:commandButton value="Update status"  style="width:100%; border: none"  
                                               rendered="#{invoiceTableController.showOptions(in.status,in.type,'ESTATUS')}" action="#{invoiceTableController.assignEstimate(in)}"  update="@(.updateEstimate)" />

                            <bnu:commandButton value="Copy"  style="width:100%; border: none"  
                                               rendered="#{invoiceTableController.showOptions(in.status,in.type,'COPY')}" action="#{invoiceTableController.copy(in)}"   />

                            <bnu:commandButton value="Receive Payment"  style="width:100%; border: none"  
                                               rendered="#{invoiceTableController.showOptions(in.status,in.type,'REPAY')}" action="#{invoiceTableController.recievePayment(in.idCust.idCust.toString(), in.idInvoice.toString())}"   />

                        </bnu:dropButton>
                        <bnu:commandButton value="#{messages.edit}"  look="warning" styleClass="hidden-lg hidden-md" action="#{invoiceTableController.edit(in)}" rendered="#{invoiceTableController.showOptions(in.status,in.type,'EDIT')}"   />

                        <bnu:commandButton value="Update status"  style="width:100%; border: none"   styleClass="hidden-lg hidden-md"
                                           rendered="#{invoiceTableController.showOptions(in.status,in.type,'ESTATUS')}" action="#{invoiceTableController.assignEstimate(in)}"   />

                        <bnu:commandButton value="#{messages.lblInvoicePrint}" update="pdf"  styleClass="hidden-lg hidden-md"  action="#{invoiceTableController.print(in,request)}" rendered="#{invoiceTableController.showOptions(in.status,in.type,'PRINT')}"  />

                        <bnu:commandButton value="Copy"  style="width:100%; border: none" styleClass="hidden-lg hidden-md" 
                                           rendered="#{invoiceTableController.showOptions(in.status,in.type,'COPY')}" action="#{invoiceTableController.copy(in)}"   />
                        <bnu:commandButton value="Receive Payment"  style="width:100%; border: none"  styleClass="hidden-lg hidden-md"
                                           rendered="#{invoiceTableController.showOptions(in.status,in.type,'REPAY')}" action="#{invoiceTableController.recievePayment(in.idCust.idCust.toString(), in.idInvoice.toString())}"   />
                    </bnu:dataTableColumn>

                </bnu:dataTable>
                
                
                
                
                
                <bnu:dataTable 
                    rendered="#{invoiceTableController.stmtList.size() > 0}"
                    value="#{invoiceTableController.stmtList}"
                    var="stmt">
                    <bnu:dataTableColumn  >
                                    <f:facet name="header">
                                        <bnu:selectBooleanCheckbox  />
                                    </f:facet>
                                    <bnu:selectBooleanCheckbox  value="#{stmt.checkbox}"  />
                                </bnu:dataTableColumn>
                    <bnu:dataTableColumn   label="#{messages.lblStmtDate}"  value="#{stmt.stmtDate}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn   label="#{messages.lblInvoiceNo}"  value="#{stmt.noDot}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblInvocieCustomer }" value="#{stmt.idCust.displayName}" ></bnu:dataTableColumn>
                    <bnu:dataTableColumn label="#{messages.lblStmtStartDate}" value="#{stmt.startDate}"  />
                    <bnu:dataTableColumn label="#{messages.lblStmtEndDate}" value="#{stmt.endDate}"  />
                    <bnu:dataTableColumn label="#{messages.lblStmtType}" value="#{invoiceTableController.formatStmtType(stmt.type)}"  />
                    <bnu:dataTableColumn label="#{messages.action}"   >
                    <bnu:dropButton value="#{messages.lblView}" look="primary" styleClass="hidden-xs hidden-sm" >
                        <bnu:commandButton value="#{messages.lblView}"  style="width:100%; border: none" action="#{invoiceTableController.viewStmt(stmt.idCust.idCust, stmt.idStmt)}"  />

                            <bnu:commandButton value="#{messages.lblInvoicePrint}"  style="width:100%; border: none"  update="@(.pdfStatement)" oncomplete="$('.printeModal').modal('show')" 
                                               action="#{invoiceTableController.generateStmt(stmt)}"             />

                           
                        </bnu:dropButton>
                    </bnu:dataTableColumn>
                </bnu:dataTable>
                
                
            </bnu:column>
        </bnu:row>
        <bnu:row>
            <bnu:column span="1">
                <label>#{messages.lblBalanceTotal}</label>
            </bnu:column>
            <bnu:column span="2">
                <h:outputText value="#{userData.formatMaster(invoiceTableController.totalBalance.toString())}" />
            </bnu:column>
            <bnu:column span="1">
                <label>#{messages.lblTotalTotal}</label>
            </bnu:column>
            <bnu:column span="2">
                <h:outputText value="#{userData.formatMaster(invoiceTableController.totalTotal.toString())}" />
            </bnu:column>
        </bnu:row>
    </bnu:form>
    <p:separator/>
    <bnu:modal  id="invoiceModal" title="#{messages.invoice}" styleClass="invoiceModal"  close-on-escape="false" backdrop="false" size="modal-lg"  >
        <h:panelGroup id="pdf" class="pdfInvoices" >

            <p:media value="#{invoiceTableController.invoiceModal}" width="100%" height="500px" rendered="#{not(invoiceTableController.invoiceModal eq '0')}"  />     


        </h:panelGroup>
    </bnu:modal>   

    <bnu:modal  id="cancelModal" title="#{messages.invoice}" styleClass="cancelModal"  close-on-escape="false" backdrop="false"  >
        <h:panelGroup id="can">
            <h:form>
                <bnu:row>
                    <bnu:column span="12">
                        <h5>#{messages.lblInCancelConfirm }</h5>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="6"><bnu:commandButton value="#{messages.yes}" look="danger" style="width: 100%" action="#{invoiceTableController.cancel()}" />
                    </bnu:column>
                    <bnu:column span="6"><bnu:commandButton value="#{messages.No}" style="width: 100%" look="success"/></bnu:column>
                </bnu:row>


            </h:form>
        </h:panelGroup>
    </bnu:modal> 


    <bnu:modal  id="updateStatusModal" title="#{messages.lblEstimate}" styleClass="updateStatusModal"   >

        <h:form  >
            <h:panelGroup class="updateEstimate" >
                <bnu:selectOneMenu label="#{messages.lblInvoiceStatus}" value="#{invoiceTableController.estimateStatus}" onchange="show(this.value);" >

                    <f:selectItem itemValue="PE" itemLabel="#{messages.lblESPending}" />
                    <f:selectItem itemValue="AC" itemLabel="#{messages.lblAccepted}" />
                    <f:selectItem itemValue="CL" itemLabel="#{messages.lblClosed}" />
                    <f:selectItem itemValue="RJ" itemLabel="#{messages.lblRejected}" />
                </bnu:selectOneMenu>
                <div class="updateEstimateStatus" style="display: none;" >
                    <bnu:inputText label="By" maxlength="30"  value="#{invoiceTableController.accBy}" />
                    <strong>
                        <h:outputText value="Date"  />

                    </strong>
                    <bnu:datepicker value="#{invoiceTableController.accDate}"    />
                </div>
            </h:panelGroup>
            <p:separator/>

            <bnu:commandButton value="Cancel" style="margin-right: 10px;" />
            <bnu:commandButton value="Ok" look="success"  action="#{invoiceTableController.updateEstimateStatus()}" />

        </h:form>

    </bnu:modal>
    
    
    
    <bnu:modal  id="stmtModal" title="#{messages.lblStatement}" size="modal-lg" styleClass="printeModal"  close-on-escape="false" backdrop="false" closable="false"   >
            <h:panelGroup id="pdfStmt" class="pdfStatement" >

                <p:media value="#{invoiceTableController.stmtPdf}" height="500px" width="100%" rendered="#{not(invoiceTableController.stmtPdf eq '0')}"  />     


            </h:panelGroup>
            <f:facet name="footer" >
                <h:form>
                    <bnu:button look="success" value="#{messages.lblClose}"  onclick="$('.printeModal').modal('hide');" />
                    
                </h:form>
            </f:facet>
        </bnu:modal> 
    


    <h:outputStylesheet>
        body .table {
        display: table;
        table-layout: fixed;
        box-sizing: border-box;
        }
        .moneyBar{
        margin-top: 35px;
        width: 100%;
        white-space: nowrap;
        font-size: 1.2rem;

        }
        body .tableRow{
        display: table-row;
        vertical-align: top;
        }
        .moneyBar * {
        outline: 0 none;
        box-sizing: border-box;
        }
        .moneyBar .tableCell {
        vertical-align: bottom;
        }
        body .tableCell {
        display: table-cell;
        vertical-align: top;
        }
        .moneyBar .bucket {
        width: 100%;
        padding-right: 5px;
        }

        .moneyBar .bucket.unbilled_tab .header {
        float: right;
        width: 50%;
        text-overflow: ellipsis;
        overflow-x: overlay;
        }

        .moneyBar .bucket .header {
        padding-bottom: 2px;
        color: #68779b;
        }
        .moneyBar .bucket .table {
        width: 100%;
        height: 68px;
        text-transform: uppercase;
        }
        .moneyBar .bucket .box.estimates {
        background-color: #21abf6;
        }
        .moneyBar .bucket .box {
        width: 100%;
        color: #ffffff;
        height: 60px;
        padding: 10px 10px 10px 10px;
        cursor: pointer;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFW…FUeNpiYGBg4GVAAErYFBtAfcNGvTbqtVGvjXqNAjZAgAEAEPYFfUaJz74AAAAASUVORK5CYII=);
        }
        .moneyBar .bucket .box .subbox {
        overflow: hidden;
        height: 41px;
        }
        body, div, dl, dt, dd, li, pre, form, fieldset, input, textarea, p, blockquote {
        margin: 0;
        padding: 0;
        }
        .moneyBar .bucket .box .subbox .amount {
        margin-bottom: 1px;
        text-transform: none;
        }
        .moneyBar .bucket .box .amount {
        font-family: "Geogrotesque", "Arial", -apple-system, "Helvetica Neue Bold", sans-serif;
        font-weight: 500;
        line-height: 1.21;
        font-size: 2.2rem;
        }
        .moneyBar .bucket .box.ccbt {
        background-color: #0077c5;
        }
        .moneyBar .bucket .box {
        width: 100%;
        color: #ffffff;
        height: 60px;
        padding: 10px 10px 10px 10px;
        cursor: pointer;
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAGXRFW…FUeNpiYGBg4GVAAErYFBtAfcNGvTbqtVGvjXqNAjZAgAEAEPYFfUaJz74AAAAASUVORK5CYII=);
        }
        .moneyBar .bucket .box .subStatuses .box {
        margin-right: 15px;
        margin-top: -51px;
        }
        .moneyBar .bucket .box.unpaid {
        background-color: #babec5;
        }
        .moneyBar .bucket .box.unpaid > .subbox {
        padding-left: 48%;
        }
        .moneyBar .bucket .box.unpaid > .subStatuses {
        float: left;
        }
        .moneyBar .bucket .box .subStatuses {
        float: right;
        width: 45%;
        }
        .moneyBar .bucket .box.overdue {
        background-color: #ff8000;
        }
        .moneyBar .bucket.paid_tab {
        padding-right: 0;
        }
        .moneyBar .bucket .box.paid {
        background-color: #7fd000;
        }

        .moneyBar .bucket
        .box.estimates.selected, .moneyBar .bucket
        .box.estimates.hover{
        border-bottom: 6px solid rgba(0,0,0,0.35);
        }

        .moneyBar .bucket .box.selected,
        .moneyBar .bucket .box.hover{
        height: 68px;
        }

        .moneyBar .bucket .box.ccbt.selected, .moneyBar .bucket .box.ccbt.hover {
        border-bottom: 6px solid rgba(0, 0, 0, 0.35);
        }

        .moneyBar .bucket .box .subStatuses .box.selected, .moneyBar .bucket .box .subStatuses .box.hover {
        margin-top: -59px;
        }
        .moneyBar .bucket .box.overdue.selected, .moneyBar .bucket .box.overdue.hover {
        border-bottom: 6px solid rgba(0, 0, 0, 0.3);
        }
        .moneyBar .bucket .box.unpaid.selected, .moneyBar .bucket .box.unpaid.hover {
        border-bottom: 6px solid rgba(0, 0, 0, 0.25);
        }
        .moneyBar .bucket .box.selected .subStatuses .box, .moneyBar .bucket .box.hover .subStatuses .box {
        height: 68px;
        border-bottom: 6px solid rgba(0, 0, 0, 0.1);
        }
        .moneyBar .bucket .box.paid.selected, .moneyBar .bucket .box.paid.hover {
        border-bottom: 6px solid rgba(0, 0, 0, 0.25);
        }        
    </h:outputStylesheet>

    <h:outputScript>
        function hoverBox(e){
        if(e == 'overdue'){
        if(#{invoiceTableController.panelFlag == 2}){
        }else{
        $('#'+e).addClass('hover');
        }
        }else{
        $('#'+e).addClass('hover');
        }

        if(e == 'unpaid'){
        if(#{invoiceTableController.panelFlag} != 0){
        $('#overdue').removeClass('selected');
        }
        }
        }


        function hoverBoxOut(e){
        $('#'+e).removeClass('hover');
        if(e == 'unpaid' ){
        if(#{invoiceTableController.panelFlag} != 0){
        if(#{invoiceTableController.panelFlag} != 2){
        $('#overdue').addClass('selected');
        }

        }

        }
        }


    </h:outputScript>


    <style>
        /* Dropdown Button */
        .dropbtn {
            background-color: #3498DB;
            color: white;
            padding: 16px;
            font-size: 16px;
            border: none;
            cursor: pointer;
        }

        .dropbtn:hover, .dropbtn:focus {
            background-color: #2980B9;
        }


        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f1f1f1;
            min-width: 600px;
            overflow: auto;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            padding: 10px;
            border: 1px solid #ddd;
        }


        .dropdown-content span {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }

        .dropdown-content span:hover {background-color: #ddd}

        .show {display:block;}

    </style>

    <h:outputScript>
        $( document ).ready(function() {
        var w = $( document ).width();

        if(w &lt;= 768){

        $('.dropdown-content').css('min-width','200px');
        }


        filterHelper.changeDate($('.filterDate').val());
        filterHelper.changeType($('.comboType').val());
        $('.cPrintTrans').attr('disabled',true);
        $('.cPrintPacking').attr('disabled',true);
        $('.cPrintTrans').addClass('disabled');
        $('.cPrintPacking').addClass('disabled');



        });


        var filterHelper = {
        fecha: new Date(),
        changeDate: function(e){

        switch(e){
        case "L3":
        var newdate = new Date(this.fecha);
        newdate.setDate(newdate.getDate() - 365); // minus the date
        var nd = new Date(newdate);
        $('.ffrom').val(this.formatDate(nd));
        $('.fto').val(this.formatDate(this.fecha));
        break;
        case "CU":

        break;
        case "TO":
        $('.ffrom').val(this.formatDate(this.fecha));
        $('.fto').val(this.formatDate(this.fecha));
        break;
        case "YE":
        var newdate = new Date(this.fecha);
        newdate.setDate(newdate.getDate() - 1); // minus the date
        var nd = new Date(newdate);
        $('.ffrom').val(this.formatDate(nd));
        $('.fto').val(this.formatDate(this.fecha));
        break;
        case "TW":
        var first = this.fecha.getDate() - this.fecha.getDay();
        var last = first + 6;
        var curr =  new Date();
        var firstday = new Date(curr.setDate(first));
        var lastday = new Date(curr.setDate(last));
        $('.ffrom').val(this.formatDate(firstday));
        $('.fto').val(this.formatDate(lastday));
        break;
        case "TM":
        var date = new Date(), y = date.getFullYear(), m = date.getMonth();
        var firstDay = new Date(y, m, 1);
        var lastDay = new Date(y, m + 1, 0);
        $('.ffrom').val(this.formatDate(firstDay));
        $('.fto').val(this.formatDate(lastDay));
        break;
        case "TQ":
        var now = new Date();
        var quarter = Math.floor((now.getMonth() / 3));
        var firstDate = new Date(now.getFullYear(), quarter * 3, 1);
        var endDate = new Date(firstDate.getFullYear(), firstDate.getMonth() + 3, 0);
        $('.ffrom').val(this.formatDate(firstDate));
        $('.fto').val(this.formatDate(endDate));
        break;
        case "TY":

        $('.ffrom').val(this.formatDate(new Date(new Date().getFullYear(), 0, 1)));
        $('.fto').val(this.formatDate(new Date(new Date().getFullYear(), 11, 31)));
        break;
        case "LW":
        var first = this.fecha.getDate() - this.fecha.getDay() - 7;
        var last = first + 6;
        var curr =  new Date();
        var firstday = new Date(curr.setDate(first));
        var lastday = new Date(curr.setDate(last));
        $('.ffrom').val(this.formatDate(firstday));
        $('.fto').val(this.formatDate(lastday));

        break;
        case "LM":
        var date = new Date(), y = date.getFullYear(), m = date.getMonth() -1;
        var firstDay = new Date(y, m, 1);
        var lastDay = new Date(y, m + 1, 0);
        $('.ffrom').val(this.formatDate(firstDay));
        $('.fto').val(this.formatDate(lastDay));

        break;
        case "LQ":
        var now = new Date();
        var quarter = Math.floor((now.getMonth() / 3));
        var firstDate = new Date(now.getFullYear(), quarter * 3 - 3, 1);
        var endDate = new Date(firstDate.getFullYear(), firstDate.getMonth() + 3, 0);
        $('.ffrom').val(this.formatDate(firstDate));
        $('.fto').val(this.formatDate(endDate));

        break;
        case "LY":
        $('.ffrom').val(this.formatDate(new Date(new Date().getFullYear()-1, 0, 1)));
        $('.fto').val(this.formatDate(new Date(new Date().getFullYear()-1, 11, 31)));
        break;
        case "AD":
        $('.ffrom').val('');
        $('.fto').val('');
        break;
        default:
        $('.ffrom').val('');
        $('.fto').val('');
        break;

        }

        },
        formatDate: function(e){
        var month = e.getMonth()+1;
        var day = e.getDate();
        if(month &lt; 10){
        month = '0' + month;
        }
        if(day &lt; 10){
        day = '0' + day;
        }
        return month + '/'+day+'/'+e.getFullYear();

        },
        changeType: function(e){
        switch(e){
        case "0":
        $('.hideStZone').show();
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusOpen}" value="OP">#{messages.lblInvoiceStatusOpen}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusOverdue}" value="OV">#{messages.lblInvoiceStatusOverdue}</option>');
        $('.statuses').append('<option data-label="#{messages.lblPaid}" value="PD">#{messages.lblPaid}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusPartial}" value="PA">#{messages.lblInvoiceStatusPartial}</option>');
        $('.statuses').append('<option data-label="#{messages.lblESPending}" value="PE">#{messages.lblESPending}</option>');
        $('.statuses').append('<option data-label="#{messages.lblAccepted }" value="AC">#{messages.lblAccepted }</option>');
        $('.statuses').append('<option data-label="#{messages.lblRejected}" value="RJ">#{messages.lblRejected}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusClosed}" value="CL">#{messages.lblInvoiceStatusClosed}</option>');
        $('.statuses').append('<option data-label="#{messages.lblUnapplied}" value="UN">#{messages.lblUnapplied}</option>');
        break;
        case "ES":
        $('.hideStZone').show();
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        $('.statuses').append('<option data-label="#{messages.lblESPending}" value="PE">#{messages.lblESPending}</option>');
        $('.statuses').append('<option data-label="#{messages.lblAccepted }" value="AC">#{messages.lblAccepted }</option>');
        $('.statuses').append('<option data-label="#{messages.lblRejected}" value="RJ">#{messages.lblRejected}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusClosed}" value="CL">#{messages.lblInvoiceStatusClosed}</option>');
        break;
        case "IN":
        $('.hideStZone').show();
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusOpen}" value="OP">#{messages.lblInvoiceStatusOpen}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusOverdue}" value="OV">#{messages.lblInvoiceStatusOverdue}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusPartial}" value="PA">#{messages.lblInvoiceStatusPartial}</option>');
        $('.statuses').append('<option data-label="#{messages.lblPaid}" value="PD">#{messages.lblPaid}</option>');
        break;
        case "SR":
        $('.hideStZone').show();
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        break;
        case "PA":
        $('.hideStZone').show();
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusClosed}" value="CL">#{messages.lblInvoiceStatusClosed}</option>');
        $('.statuses').append('<option data-label="#{messages.lblInvoiceStatusPartial}" value="PA">#{messages.lblInvoiceStatusPartial}</option>');
        $('.statuses').append('<option data-label="#{messages.lblUnapplied}" value="UN">#{messages.lblUnapplied}</option>');
        break;
        case "ST":
        $(".statuses option").remove();
        $('.statuses').append('<option data-label="#{messages.lblAllStatuses}" value="0">#{messages.lblAllStatuses}</option>');
        $('.hideStZone').hide();
        break;
        default:
        console.log('Opcion sin soporte');
        break;
        }


        },
        changeStatus: function(e){
        if($('.comboType').val() == '0'){
        switch(e){
        case "0":
        console.log(e);
        break;
        case "OP":
        console.log(e);
        $('.comboType').val('IN');
        this.changeType('IN');
        $('.statuses').val(e);
        break;
        case "OV":
        console.log(e);
        $('.comboType').val('IN');
        this.changeType('IN');
        $('.statuses').val(e);
        break;
        case "PD":
        console.log(e);
        $('.comboType').val('IN');
        this.changeType('IN');
        $('.statuses').val(e);
        break;
        case "PA":
        console.log(e);
        $('.comboType').val('IN');
        this.changeType('IN');
        $('.statuses').val(e);
        break;
        case "PE":
        console.log(e);
        $('.comboType').val('ES');
        this.changeType('ES');
        $('.statuses').val(e);
        break;
        case "AC":
        console.log(e);
        $('.comboType').val('ES');
        this.changeType('ES');
        $('.statuses').val(e);
        break;
        case "RJ":
        console.log(e);
        $('.comboType').val('ES');
        this.changeType('ES');
        $('.statuses').val(e);
        break;
        case "CL":
        console.log(e);
        $('.comboType').val('PA');
        this.changeType('PA');
        $('.statuses').val(e);
        break;
        case "UN":
        console.log(e);
        $('.comboType').val('PA');
        this.changeType('PA');
        $('.statuses').val(e);
        break;
        default:
        console.log('Not Supported');
        break;
        }
        }



        }

        };



        function myFunction() {
        $(".dropdown-content").show();
        };

        $(document).on("click",function(event) {

        var str = $(event.target).parent().parent().parent().attr('class')+' '+$(event.target).parent().parent().attr('class')+' '+$(event.target).parent().attr('class') + ' ' + $(event.target).attr('class');
        //alert(str.indexOf("dropLi")>=0);
        if(str.indexOf("dropLi")>=0){


        }else{
        //alert(str);
        $(".dropdown-content").hide();
        }



        });


        function soloDate(e) 
        { 
        //alert(obj.value);
        var str = $('.'+e).val();
        var patt = new RegExp("^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]{2})*$");
        var res = patt.test(str);

        if(res){
        }else{
        $('.'+e).val(filterHelper.formatDate(new Date()));
        $('.'+e).css('background-color','white');
        $('.'+e).css('color','black');
        }
        //obj.value = (obj.value + '').replace(/^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]{2})*$/g, '');
        }
        
        
        function soloDateVal(e) 
        { 
        
        var str = $('.'+e).val();
        var patt = new RegExp("^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]{2})*$");
        var res = patt.test(str);
        
        if(res){
        $('.'+e).css('background-color','white');
        $('.'+e).css('color','black');
        }else{
        $('.'+e).css('background-color','red');
        $('.'+e).css('color','white');
        }
        
        }



        function show(value){

        if(value == "PE"){
        $(".updateEstimateStatus").hide();
        //alert(value);
        }else{
        $(".updateEstimateStatus").show();
        //alert(value);
        }
        }



        function redirectPanel(op){

        window.location.replace('#{request.contextPath}/view/sales/sales.xhtml?pv='+op);
        }
        
        
        var batchHelper= {
        checks: [],
        activateOption: function(e,id){
        var c = 0;
        if(this.checks.length == 0){
        this.checks.push({tipo:e,iden:id});
        }else{
        for(var i =0;i &lt; this.checks.length;i++){
        //console.log(this.checks[i].tipo + ' ' + this.checks[i].iden);
        if(this.checks[i].iden == id){
        c++;
        var index = this.checks.indexOf(this.checks[i]);
        }
        }
        if(c == 0){
        this.checks.push({tipo:e,iden:id});
        }else{
        this.checks.splice(index, 1);
        }
        
        for(var i =0;i &lt; this.checks.length;i++){
        console.log(this.checks[i].tipo + ' ' + this.checks[i].iden);
        
        }
        console.log('================================================');
        
        }
        this.enableOption();
        },
        enableOption: function(){
        //alert(this.checks.length);
        if(this.checks.length == 0){
        $('.cPrintTrans').attr('disabled',true);
        $('.cPrintPacking').attr('disabled',true);
        $('.cPrintTrans').addClass('disabled');
        $('.cPrintPacking').addClass('disabled');
        }
        var ce = 0;
        var cp = 0;
        var cs = 0;
        var ci = 0;
        for(var i =0;i &lt; this.checks.length;i++){
       // console.log(this.checks[i].tipo + ' ' + this.checks[i].iden);
            
            if(this.checks[i].tipo == 'SR'){
            cs++;
            }
            if(this.checks[i].tipo == 'IN'){
            ci++;
            }
            if(this.checks[i].tipo == 'PA'){
            cp++;
            
            }
            if(this.checks[i].tipo == 'ES'){
            ce++;
            
            }
            
            
        }
            if(cs != 0){
              $('.cPrintTrans').attr('disabled',false);
              $('.cPrintPacking').attr('disabled',false);
              $('.cPrintTrans').removeClass('disabled');
              $('.cPrintPacking').removeClass('disabled');  
            }
        
            if(ci != 0){
              $('.cPrintTrans').attr('disabled',false);
              $('.cPrintPacking').attr('disabled',false);
              $('.cPrintTrans').removeClass('disabled');
              $('.cPrintPacking').removeClass('disabled'); 
            }
            
            if(cp != 0){
              $('.cPrintTrans').attr('disabled',true);
              $('.cPrintPacking').attr('disabled',true);
              $('.cPrintTrans').addClass('disabled');
              $('.cPrintPacking').addClass('disabled');  
            }
            
            if(ce != 0){
                $('.cPrintPacking').attr('disabled',true);
                $('.cPrintPacking').addClass('disabled');  
            }
        }
        };
        

    </h:outputScript>






</ui:fragment>

