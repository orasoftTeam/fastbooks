<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:bnu="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <f:view locale="#{ userData.locale}"/>
    <h:head>
        <title>Fastbooks</title>
    </h:head>
    <h:body>
        <h:form id="paymentForm" >
            <bnu:container styleClass="marco">
                <bnu:row>
                    <bnu:column span="11">
                        <h3>#{paymentController.title} </h3>

                    </bnu:column>
                    <bnu:column span="1">
                        <h2><h:commandLink style="text-decoration: none;color: black" action="#{invoiceController.validationBean.redirecionar('/view/sales/sales.xhtml')}" >âœ–</h:commandLink></h2>
                    </bnu:column>

                </bnu:row> 
                <p:separator/>
                <h:panelGroup id="custs">
                    #{paymentController.refreshComboCust()}
                    <bnu:row>
                        <bnu:column span="4">
                            <bnu:selectOneMenu label="#{messages.lblInvocieCustomer}" value="#{paymentController.idCust}" onchange="ajax:paymentController.changeCust();" update="@(.campos)" >
                                <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                                <f:selectItems value="#{paymentController.CList}" var="cust"
                                               itemValue="#{cust.idCust}" itemLabel="#{cust.title} #{cust.firstname} #{cust.lastname}"  itemDescription="#{cust.company}" />
                            </bnu:selectOneMenu>


                        </bnu:column>
                        <bnu:column span="3" class="campos" >
                            <bnu:inputText label="#{messages.email}" value="#{paymentController.email}"  id="email" placeholder="Customer email" maxlength="20"   />

                        </bnu:column>
                        <bnu:column span="3">

                        </bnu:column>
                        <bnu:column span="2" class="campos" >
                            <h4 style="margin-top: -5px">#{messages.lblAmountReceived}</h4>
                            <h1 style="margin-top: -5px" >#{paymentController.DAmount}</h1>
                        </bnu:column>
                    </bnu:row>
                </h:panelGroup>
                <bnu:row>
                      <bnu:column span="4">
                            <bnu:button        
                                value="#{messages.newC}" look="success" 
                                onclick="PF('dlg2').show();"/>
                        </bnu:column>
                
                    <bnu:column span="2" >
                        <strong>
                            <h:outputText value="#{messages.lblPaymentDate}"  />

                        </strong>
                        <bnu:datepicker style="margin-top: 4px;" value="#{paymentController.paymentDate}" ></bnu:datepicker>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="4" >
                        <bnu:selectOneMenu label="#{messages.lblPaymentMethod}" value="#{paymentController.PMethod}" >
                            <f:selectItems value="#{paymentController.PMethodList}" var="pm"
                                           itemValue="#{pm.display}" itemLabel="#{pm.display}" />
                        </bnu:selectOneMenu>
                    </bnu:column>
                    <bnu:column span="2" >
                        <bnu:inputText label="#{messages.lblReferenceNo}" value="#{paymentController.PReferenceNo}" onkeyup="soloNumeros(this);" maxlength="20" />
                    </bnu:column>
                    <bnu:column span="4" >

                    </bnu:column>
                    <bnu:column span="2" class="campos" >
                        <bnu:inputText label="#{messages.lblAmountReceivedLower}" value="#{paymentController.DAmount}" onblur="ajax:paymentController.calcularPagos();" update="@(.campos)"
                                       id="amount" />
                    </bnu:column>
                </bnu:row>
                <p:separator />
                <h:panelGroup id="messages" class="messages" >
                <bnu:row>
                    <bnu:column span="12">
                        <bnu:messages showDetail="true" />
                    </bnu:column>
                </bnu:row>
                </h:panelGroup>
                <h:panelGroup id="TblTransactions" class="campos"   >
                    
                    <h:panelGroup rendered="#{paymentController.renderMaster('TBL')}" >
                    <bnu:dataTable
                        
                        value="#{paymentController.payDetailList}"
                        var="pd"
                         >
                        <bnu:dataTableColumn label="PAY">
                            <bnu:selectBooleanCheckbox  value="#{pd.checkbox}" onclick="ajax:paymentController.aplicarPagoCheck('#{pd.idInvoice.idInvoice}');" update="@(.campos)" />
                        </bnu:dataTableColumn>
                        <bnu:dataTableColumn label="DESCRIPCION">
                            <h:commandLink action="#{invoiceTableController.edit(pd.idInvoice)}" >  #{pd.descrip} </h:commandLink>
                        </bnu:dataTableColumn>
                        <bnu:dataTableColumn label="DUE DATE">
                            #{pd.dueDate}
                        </bnu:dataTableColumn>
                        <bnu:dataTableColumn label="ORIGINAL AMOUNT">
                            #{paymentController.formatDoubleMaster(pd.originalAmount)}
                        </bnu:dataTableColumn>
                        <bnu:dataTableColumn label="OPEN BALANCE">
                            #{paymentController.formatDoubleMaster(pd.openBalance)}
                        </bnu:dataTableColumn>
                        <bnu:dataTableColumn label="PAYMENT">
                            <bnu:inputText value="#{pd.paymentString}" onblur="ajax:paymentController.aplicarPagoADetalle();" update="@(.campos)" />
                        </bnu:dataTableColumn>
                    </bnu:dataTable>
                    
                    <bnu:row>
                        <bnu:column span="7"/>
                        <bnu:column span="5">
                            <div class="form-group row">
                            <label class="col-form-label col-sm-4" >
                                
                            </label>
                                <label class="col-form-label col-sm-6" >
                                #{messages.lblAmountToApply}
                            </label>
                            <div class="col-sm-2">
                                #{paymentController.DAmountApply}
                            </div>
                        </div>
                            
                            <div class="form-group row">
                                <label class="col-form-label col-sm-4" >
                                
                            </label>
                            <label class="col-form-label col-sm-6" >
                                #{messages.lblAmountToCredit}
                            </label>
                            <div class="col-sm-2">
                                #{paymentController.DAmountCredit}
                            </div>
                        </div>
                            
                            <div class="form-group row">
                            <label class="col-form-label col-sm-8" >
                               
                            </label>
                            <div class="col-sm-4">
                                <bnu:commandButton value="#{messages.lblClearPayment}" action="#{invoiceController.validationBean.redirecionar('/view/sales/payments/paymentForm.xhtml')}" />
                            </div>
                        </div>
                        </bnu:column>
                    </bnu:row>
                    </h:panelGroup>
                    
                    
                    <bnu:row rendered="#{paymentController.renderMaster('NO_DATA')}" >
                        <bnu:column span="8">
                            <bnu:alert severity="info" title="#{messages.lblNoTransactionTitle}" >
                                #{messages.lblNoTransactionBody}
                            </bnu:alert >

                        </bnu:column>

                    </bnu:row>
                    
                    
                </h:panelGroup>
                
                
                <bnu:row>
                    <bnu:column  span="4" >
                        <bnu:inputTextarea label="Memo" onkeyup="document.getElementById('memo').value = this.value;" maxlength="500" value="#{paymentController.DMemo}" />
                    </bnu:column>
                </bnu:row>
                <!--<bnu:row>
                    <bnu:column  span="4" >
                        <bnu:inputTextarea label="Attachments" />
                    </bnu:column>
                </bnu:row>-->
              
                <p:separator/>
            </bnu:container>

        </h:form>
        
        <!--navbar begin-->
        <bnu:navBar  inverse="true" position="bottom" fixed="true" >
            <h:panelGroup id="clear" class="campos" >
                <h:form styleClass="navbar-form navbar-left"  id="navBtn1" >
                    <bnu:commandButton value="Cancel" styleClass="btnBottom"  action="#{invoiceController.validationBean.redirecionar('/view/sales/sales.xhtml')}" rendered="#{!paymentController.formTouched}" />
                    <bnu:button value="Cancel" styleClass="btnBottom"  onclick="PF('dlg5').show();" rendered="#{paymentController.formTouched}" />
                    <bnu:button value="Clear" style="margin-left: 10px" styleClass="btnBottom" onclick="PF('dlg6').show();"  rendered="#{paymentController.formTouched}"  />
                </h:form>
            </h:panelGroup>
            <bnu:navbarLinks >
                <bnu:navLink value="Preview" href="#"  ></bnu:navLink>
                <bnu:navLink value="Delete" onclick="PF('dlg8').show();" rendered="#{paymentController.modifica()}"   ></bnu:navLink>
            </bnu:navbarLinks>
            <h:form styleClass="navbar-form navbar-right" >
                <input type="hidden" name="memo"  id="memo" />
                <bnu:commandButton value="#{messages.save}"  look="success"  style="width: 100%" action="#{paymentController.save('A')}" update="@(.messages)" rendered="#{!paymentController.modifica()}"  />
                <bnu:button value="#{messages.save}"  look="success"  style="width: 100%"  onclick="PF('dlg7').show();" rendered="#{paymentController.modifica()}" />
            </h:form>
        </bnu:navBar>
        
        
        
        <!-- navbar end -->
        
        
         <!-- modal confirm exit -->
        <p:dialog header="Modal Dialog" widgetVar="dlg5" modal="true" height="100">
            <h:outputText value="Do you want to leave without saving?" /><br/>
            <p:separator />

            <h:form id="confirmModal">
                <bnu:button value="No" onclick="PF('dlg5').hide();" />
                <bnu:commandButton value="Yes" look="success" action="#{invoiceController.validationBean.redirecionar('/view/sales/sales.xhtml')}" style="margin-left: 10px" />
            </h:form>
        </p:dialog> 


        <p:dialog header="Modal Dialog" widgetVar="dlg6" modal="true" height="100">
            <h:outputText value="Are you sure you want to clear this transaction?" /><br/>
            <p:separator />

            <h:form id="confirmModalReset">
                <bnu:button value="No" onclick="PF('dlg6').hide();" />
                <bnu:commandButton value="Yes" look="success" action="#{invoiceController.validationBean.redirecionar('/view/sales/payments/paymentForm.xhtml')}" style="margin-left: 10px"  />
            </h:form>
        </p:dialog> 
         
        <p:dialog header="Confirmation" widgetVar="dlg7" modal="true" height="100">
            <h:outputText value="This transaction is linked to invoices, are you sure that you want to save? invoices linked to this payment will be updated" /><br/>
            <p:separator />

            <h:form id="confirmModalSaveLink">
                <bnu:button value="No" onclick="PF('dlg7').hide();" />
                
                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{paymentController.save('U')}"  />
                
            </h:form>
        </p:dialog>
        
        <p:dialog header="Confirmation" widgetVar="dlg8" modal="true" height="150">
            <bnu:alert severity="danger">
                <h:outputText value="Are you sure you want to delete this?" />
            </bnu:alert>
            
            <p:separator />

            <h:form id="confirmModalDelete">
                <bnu:button value="No" onclick="PF('dlg8').hide();" />
                
                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{paymentController.save('D')}" />
                
            </h:form>
        </p:dialog>           

        <!-- end modal exit-->
        
        
        <!-- modal clientes -->
        <ui:include src="../customer/customerForm.xhtml" />
        
        <!--modal clientes -->
        
        <h:outputScript>
            function soloNumeros(obj) 
            { 
            obj.value = (obj.value + '').replace(/[^0-9]/g, '');
            }
            
           
           
        </h:outputScript>
        
        <style>
            body{
                background-color: #ccffff;
            }
            .marco{
                background-color: #ffffff;
            }

            .btnBottom{
                background-color: black;
                color: white;

            }

            .btnBottom:hover{
                background-color: #666666;

            }
        </style>
        
    </h:body>
</html>

