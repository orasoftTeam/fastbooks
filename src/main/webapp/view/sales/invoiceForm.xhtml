<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:bnu="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <f:view locale="#{ userData.locale}"/>
    <h:head>
        <title>Fastbooks</title>
    </h:head>
    <h:body>

        <h:form id="invoiceForm">
            <bnu:container styleClass="marco">
                #{invoiceController.init()}        
                #{invoiceController.assign()}
                #{invoiceController.parseDates()}

                <bnu:row>
                    <bnu:column span="12">
                        <h3>#{messages.lblInvoiceTypeIn} <ui:fragment rendered="#{invoiceController.modStay}">#{invoiceController.inNo}</ui:fragment> </h3>

                    </bnu:column>


                </bnu:row>
                <bnu:row>
                    <bnu:column span="12">
                        <bnu:navLink href="#{request.contextPath}/view/sales/sales.xhtml" value="#{messages.lblBackToSales}" />
                    </bnu:column>
                </bnu:row>
                <p:separator/>
                <bnu:row>
                    <bnu:column span="4">
                        <bnu:selectOneMenu label="#{messages.lblInvocieCustomer}" value="#{invoiceController.idCust}" onchange="ajax:invoiceController.changeCust();" update="@form" >
                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                            <f:selectItems value="#{invoiceController.CList}" var="cust"
                                           itemValue="#{cust.idCust}" itemLabel="#{cust.title} #{cust.firstname} #{cust.lastname}"  itemDescription="#{cust.company}" />
                        </bnu:selectOneMenu>

                    </bnu:column>
                    <bnu:column span="3">
                        <bnu:inputText label="#{messages.email}" value="#{invoiceController.email}"  id="email" placeholder="Customer email" maxlength="20" />
                    </bnu:column>
                    <bnu:column span="3">

                    </bnu:column>
                    <bnu:column span="2">
                        <h4 style="margin-top: -5px">#{messages.lblInvoiceBalanceDue}</h4>
                        <h1 style="margin-top: -5px" >#{invoiceController.DBalance}</h1>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="4">
                        <bnu:inputTextarea label="#{messages.billingA}" maxlength="250" value="#{invoiceController.biAddress}" />

                    </bnu:column>
                    <bnu:column span="2">
                        <bnu:selectOneMenu label="#{messages.lblInvoiceTerms}" value="#{invoiceController.termDays}" onchange="ajax:invoiceController.updateDate();" update="@form" >
                            <f:selectItems value="#{invoiceController.TList}" var="term"
                                           itemLabel="#{term.display}" itemValue="#{term.days}" />
                        </bnu:selectOneMenu>
                    </bnu:column>
                    <bnu:column span="2">
                        <strong><h:outputText value="#{messages.lblInvoiceInDate}"  /></strong>
                        <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.invoiceDate}" ></bnu:datepicker>
                    </bnu:column>
                    <bnu:column span="2">
                        <strong><h:outputText value="#{messages.lblIncoiceDueDate}"  /></strong>
                        <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.dueDate}" ></bnu:datepicker>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="4">
                        <bnu:inputTextarea label="#{messages.shippingA}" value="#{invoiceController.shAddress}" maxlength="250" />

                    </bnu:column>
                    <bnu:column span="2">
                        <bnu:inputText label="#{messages.lblInvoiceShipVia}" maxlength="15" value="#{invoiceController.shVia}" />
                    </bnu:column>
                    <bnu:column span="2">
                        <strong><h:outputText value="#{messages.lblInvoiceShipDate}"  /></strong>
                        <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.shipDate}" ></bnu:datepicker>
                    </bnu:column>
                    <bnu:column span="2">
                        <bnu:inputText label="#{messages.lblInvoiceTrackNum}" onkeyup="soloNumeros(this)" maxlength="15" value="#{invoiceController.trackNo}" />
                    </bnu:column>
                </bnu:row>
                <p:separator/>
                <bnu:row>
                    <bnu:column span="12">
                        <bnu:messages />

                    </bnu:column>


                </bnu:row>
                <bnu:row>
                    <bnu:column span="6">
                        <bnu:selectOneMenu label="#{messages.lblProductComplete}" value="#{invoiceController.idProd}" style="font-weight: bold" >
                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                            <f:selectItems value="#{invoiceController.PList}" var="prod" 
                                           itemLabel="#{invoiceController.formatProdDisplay(prod)}" itemValue="#{prod.idProd}" />
                        </bnu:selectOneMenu>

                    </bnu:column>
                    <!--<bnu:column span="4">
                        <bnu:inputText label="Quantity"  onkeyup="soloNumeros(this)" maxlength="4" />
                        
                    </bnu:column>-->
                    <bnu:column span="6">
                        <bnu:commandButton ajax="true" update="@form" value="#{messages.lblAddProductBundle}" look="success" style="margin-top: 25px;width: 100%" action="#{invoiceController.addDetail()}" />

                    </bnu:column>
                </bnu:row>

                <p:separator/>
                <bnu:row>
                    <bnu:column span="4">
                        <bnu:selectOneMenu  update="@form" value="#{invoiceController.hasTax}" onchange="ajax:invoiceController.updateTotal();" >
                            <f:selectItem itemLabel="#{messages.lblInvoiceWTax}" itemValue="true" />
                            <f:selectItem itemLabel="#{messages.lblInvoiceWTTax}" itemValue="false" />
                        </bnu:selectOneMenu>

                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="12">
                        <bnu:dataTable
                            paginated="false"
                            searching="false"
                            responsive="true"
                            id="tblDetail"
                            value="#{invoiceController.DList}"
                            var="det">
                            <bnu:dataTableColumn label="#{messages.lblProductComplete}" value="#{det.itemName}" />
                            <bnu:dataTableColumn label="#{messages.lblSKU}" value="#{det.itemSku}" />
                            <bnu:dataTableColumn label="#{messages.lblDesc}" value="#{det.itemDesc}" />
                            <bnu:dataTableColumn label="#{messages.lblQuant}"  >
                                <bnu:inputText  value="#{det.itemQuant}"  tooltip="#{invoiceController.tooltipQuant(det.idProd)}" onkeyup="soloNumeros(this)" maxlength="4"   onblur="ajax:invoiceController.updateTotal();"  update="@form" />
                            </bnu:dataTableColumn>
                            <bnu:dataTableColumn label="#{messages.lblInDetRate}" value="#{det.itemRate}" />
                            <bnu:dataTableColumn label="#{messages.lblInDetAmount}" value="#{invoiceController.formatOutput(det.itemAmount)}" />
                            <bnu:dataTableColumn label="#{messages.lblInvoiceTax}" rendered="#{invoiceController.hasTax}" >
                                <bnu:selectOneMenu value="#{det.itemTax}" update="@form" onchange="ajax:invoiceController.updateTotal();" >
                                    <f:selectItems value="#{invoiceController.taxList}" var="tax" itemLabel="#{tax.name} (#{tax.rate}%)" itemValue="#{tax.idTax.toString()}" />
                                </bnu:selectOneMenu>
                            </bnu:dataTableColumn>
                            <bnu:dataTableColumn label="" >
                                <bnu:commandButton icon-awesome="fa-trash" value="" icon-size="lg" ajax="true" update="@form" action="#{invoiceController.removeDetail(det)}"  />
                            </bnu:dataTableColumn>
                        </bnu:dataTable>
                    </bnu:column>
                </bnu:row>
                <p:separator/>
                <bnu:row>
                    <bnu:column span="8" >
                        <!--<bnu:inputTextarea label="Message displayed on invoice" />-->
                    </bnu:column>
                    <bnu:column span="2">
                        <h4> #{messages.lblInvoiceSubTotal}</h4>
                    </bnu:column>
                    <bnu:column span="2">
                        <h4> #{invoiceController.DSubTotal}</h4>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="8">

                    </bnu:column>
                    <bnu:column span="2">
                        <h4>#{messages.lblInShipCost}</h4>
                    </bnu:column>
                    <bnu:column span="2">
                        <bnu:inputText value="#{invoiceController.shCost}" maxlength="6"  onblur="ajax:invoiceController.updateTotal();"  update="@form" />
                    </bnu:column>
                </bnu:row>
                <ui:repeat value="#{invoiceController.taxesAmountList}" var="it">
                    <bnu:row>
                        <bnu:column span="8">

                        </bnu:column>
                        <bnu:column span="2">
                            <h4>#{it.idTax.name} #{it.idTax.rate}% #{messages.lblInTaxOf} #{invoiceController.formatOutput(it.fromAmount)}</h4>
                        </bnu:column>
                        <bnu:column span="2">
                            <h4>#{invoiceController.formatOutput(it.taxAmount)}</h4>
                        </bnu:column>
                    </bnu:row>

                </ui:repeat>
                <bnu:row>
                    <bnu:column span="8">

                    </bnu:column>
                    <bnu:column span="2">
                        <h4>#{messages.lblInvoiceTotal}</h4>
                    </bnu:column>
                    <bnu:column span="2">
                        <h4>#{invoiceController.DTotal}</h4>
                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="8">

                    </bnu:column>
                    <bnu:column span="2">
                        <h4>#{messages.lblInvoiceBalanceDue}</h4>
                    </bnu:column>
                    <bnu:column span="2">
                        <h4>#{invoiceController.DBalance}</h4>
                    </bnu:column>
                </bnu:row>
                <p:separator/>
                <bnu:row>
                    <bnu:column span="3"></bnu:column>
                    <bnu:column span="6"></bnu:column>
                    <bnu:column span="3">

                        <bnu:commandButton value="#{messages.save}"  look="success" size="lg" style="width: 100%" action="#{invoiceController.save('A')}" rendered="#{!invoiceController.modStay}"  />
                        <bnu:commandButton value="#{messages.lblUpdateIn}"  look="success" size="lg" style="width: 100%"  action="#{invoiceController.save('U')}" rendered="#{invoiceController.modStay}" />
                    </bnu:column>
                    <!--<bnu:column span="3">
                        <bnu:commandButton value="Close"  look="danger" size="lg" style="width: 100%" />
                        
                    </bnu:column>-->
                </bnu:row>
                <p:separator/>
            </bnu:container>
        </h:form>
        <h:outputScript>
            function soloNumeros(obj) 
            { 
            obj.value = (obj.value + '').replace(/[^0-9]/g, '');
            }
            //$.blockUI({ message: 'Hold on!' });      
            function mensaje(e){
            alert(e);
            } 
        </h:outputScript>
        <style>
            body{
                background-color: #ccffff;
            }
            .marco{
                background-color: #ffffff;
            }
        </style>

        <!-- <h:outputStylesheet>
              body{
                 background-color: #20b2aa;
             }
         </h:outputStylesheet>-->
    </h:body>
</html>

