<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:bnu="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <f:view locale="#{ userData.locale}"/>
    <h:head>
        <title>#{userData.GParameters.title}</title>
    </h:head>
    <h:body>

        <h:form id="invoiceForm">
            
            <bnu:container styleClass="marco">
              

                <bnu:row>
                    <bnu:column span="11">
                        <h3>#{invoiceController.title} <ui:fragment rendered="#{invoiceController.modStay}">#{invoiceController.inNo}</ui:fragment> </h3>

                    </bnu:column>
                    <bnu:column span="1">
                        <h2><h:commandLink style="text-decoration: none;color: black" action="#{invoiceController.regresar()}">âœ–</h:commandLink></h2>
                    </bnu:column>


                </bnu:row>
                <bnu:row>
                    <bnu:column span="12">

                    </bnu:column>
                </bnu:row>
                <p:separator/>
               
                    <bnu:row>
                        <bnu:column span="4" class="addCustSuccess"  >

                            
                            <bnu:selectOneMenu label="#{messages.lblInvocieCustomer}" value="#{invoiceController.idCust}" onchange="ajax:invoiceController.changeCust();"   update="@(.customerInfo)" >
                                <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                                <f:selectItems value="#{invoiceController.CList}" var="cust"
                                               itemValue="#{cust.idCust}" itemLabel="#{cust.displayName}"  itemDescription="#{cust.company}" />
                            </bnu:selectOneMenu>


                        </bnu:column>
                        <bnu:column span="3" class="customerInfo addCustSuccess" >
                            <bnu:inputText label="#{messages.email}" value="#{invoiceController.email}"  id="email" placeholder="Customer email" maxlength="20"  onblur="ajax:invoiceController.didUserTouchForm();" />

                        </bnu:column>
                        <bnu:column span="3">

                        </bnu:column>
                        <bnu:column span="2" class="lowSection" >
                            <h:panelGroup rendered="#{invoiceController.showSegunType('CN')}" ><h4 style="margin-top: -5px">#{messages.lblAmountToRefund}</h4></h:panelGroup>
                            <h:panelGroup rendered="#{!invoiceController.showSegunType('CN')}" ><h4 style="margin-top: -5px">#{messages.lblInvoiceBalanceDue}</h4></h:panelGroup>
                            <h1 style="margin-top: -5px" >#{invoiceController.showBalanceDue()}</h1>
                            <bnu:commandButton value="Receive Payment" rendered="#{invoiceController.showReceivePayment()}" action="#{invoiceTableController.recievePayment(invoiceController.idCust, invoiceController.idInvoice)}" /><br/>
                            <h:panelGroup rendered="#{invoiceController.paymentDetailList.size() > 0}" ><h:outputText escape="false" value="#{invoiceController.paymentMade}" />
                                <div id="myDropdown" class="dropdown-content dropLi">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th align="center" >
                                                    <h:outputText value="Date " />
                                                </th>
                                                <th align="center" >
                                                    <h:outputText value="Amount applied" />
                                                </th>
                                                <th align="center" style="padding: 5px" >
                                                    <h:outputText value="Payment no. " />
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <ui:repeat value="#{invoiceController.paymentDetailList}" var="pay">
                                                <tr  >
                                                    <td align="center" >
                                                        <h:commandLink action="#{invoiceTableController.edit(pay.idPayment)}" ><h:outputText value="#{pay.idPayment.inDate} " /></h:commandLink>
                                                    </td>
                                                    <td align="center" >
                                                        <h:outputText value="#{userData.formatMaster(pay.payment.toString())} " />
                                                    </td>
                                                    <td align="center" >
                                                        <h:outputText value="#{pay.idPayment.payReferenceNo}" />
                                                    </td>
                                                </tr>
                                            </ui:repeat>
                                        </tbody>
                                    </table>
                                </div>
                            </h:panelGroup>

                        </bnu:column>
                    </bnu:row>
                    <bnu:row>
                        <bnu:column span="4">
                            <bnu:button        
                                value="#{messages.newC}" look="success" 
                                onclick="$('.addCustModal').modal();"/>
                        </bnu:column>
                        <bnu:column span="2"  rendered="#{invoiceController.showSegunType('ES')}">
                            <bnu:selectOneMenu label="#{messages.lblInvoiceStatus}" value="#{invoiceController.estimateStatus}" onchange="show(this.value);" >
                                <f:selectItem itemValue="PE" itemLabel="#{messages.lblESPending}" />
                                <f:selectItem itemValue="AC" itemLabel="#{messages.lblAccepted}" />
                                <f:selectItem itemValue="CL" itemLabel="#{messages.lblClosed}" />
                                <f:selectItem itemValue="RJ" itemLabel="#{messages.lblRejected}" />
                            </bnu:selectOneMenu>
                        </bnu:column>
                        <div class="updateEstimateStatus" style="display: none;" >
                            <bnu:column span="2" >
                                <bnu:inputText label="By" maxlength="30"  value="#{invoiceController.accBy}" />
                            </bnu:column>
                            <bnu:column span="2"  >
                                <strong>
                                    <h:outputText value="Date"  />

                                </strong>
                                <bnu:datepicker value="#{invoiceController.accDate}"    />
                            </bnu:column>
                        </div>






                    </bnu:row>
                    <bnu:row rendered="#{invoiceController.copy}" >
                        <bnu:column span="8">
                            <bnu:alert severity="info" title="#{messages.lblCopy}" >
                                #{messages.lblCopy1} #{invoiceController.title}. #{messages.lblCopy2} #{invoiceController.title}.  
                            </bnu:alert >

                        </bnu:column>

                    </bnu:row>


                    <bnu:row>
                        <bnu:column span="4" class="customerInfo addCustSuccess" >
                            <bnu:inputTextarea label="#{messages.billingA}" maxlength="250" value="#{invoiceController.biAddress}" onblur="ajax:invoiceController.didUserTouchForm();" />

                        </bnu:column>
                        <bnu:column span="2"  rendered="#{invoiceController.showSegunType('IN')}" > <!--HACER QUE ACTUALICE SOLO LAS FECHAS -->
                            <bnu:selectOneMenu label="#{messages.lblInvoiceTerms}" value="#{invoiceController.termDays}" onchange="ajax:invoiceController.updateDate();" update="@(.datesIn)" >
                                <f:selectItems value="#{invoiceController.TList}" var="term"
                                               itemLabel="#{term.display}" itemValue="#{term.days}" />
                            </bnu:selectOneMenu>
                        </bnu:column>
                        <bnu:column span="2">
                            <strong>
                                <h:outputText value="#{messages.lblCreditNoteDate}" rendered="#{invoiceController.showSegunType('CN')}" />
                                <h:outputText value="#{messages.lblSalesReceiptDate}" rendered="#{invoiceController.showSegunType('SR')}" />
                                <h:outputText value="#{messages.lblInvoiceInDate}" rendered="#{invoiceController.showSegunType('IN')}" />
                                <h:outputText value="#{messages.lblEstimateDate}" rendered="#{invoiceController.showSegunType('ES')}" />
                            </strong>
                            <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.invoiceDate}" class="datesIn" ></bnu:datepicker>
                        </bnu:column>
                        <bnu:column span="2"  rendered="#{invoiceController.showSegunType('IN') || invoiceController.showSegunType('ES')}" >
                            <strong>
                                <h:outputText value="#{messages.lblIncoiceDueDate}" rendered="#{invoiceController.showSegunType('IN')}" />
                                <h:outputText value="#{messages.lblEstimateExpDate}" rendered="#{invoiceController.showSegunType('ES')}" />
                            </strong>
                            <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.dueDate}" class="datesIn" ></bnu:datepicker>
                        </bnu:column>
                    </bnu:row>
                    <bnu:row  rendered="#{!invoiceController.showSegunType('CN')}" >
                        <bnu:column span="4" class="customerInfo addCustSuccess" >
                            <bnu:inputTextarea label="#{messages.shippingA}" value="#{invoiceController.shAddress}" maxlength="250" onblur="ajax:invoiceController.didUserTouchForm();" />

                        </bnu:column>
                        <bnu:column span="2">
                            <bnu:inputText label="#{messages.lblInvoiceShipVia}" maxlength="15" value="#{invoiceController.shVia}" onblur="ajax:invoiceController.didUserTouchForm();" />
                        </bnu:column>
                        <bnu:column span="2">
                            <strong><h:outputText value="#{messages.lblInvoiceShipDate}"  /></strong>
                            <bnu:datepicker style="margin-top: 4px;" value="#{invoiceController.shipDate}" ></bnu:datepicker>
                        </bnu:column>
                        <bnu:column span="2">
                            <bnu:inputText label="#{messages.lblInvoiceTrackNum}" onkeyup="soloNumeros(this)" maxlength="15" value="#{invoiceController.trackNo}" onblur="ajax:invoiceController.didUserTouchForm();" />
                        </bnu:column>
                    </bnu:row>
               

                <bnu:row  rendered="#{invoiceController.showSegunType('SR')}">
                    <bnu:column span="4" >
                        <bnu:selectOneMenu label="#{messages.lblPaymentMethod}">
                            <f:selectItems value="#{invoiceController.PMethodList}" var="pm"
                                           itemValue="#{pm.display}" itemLabel="#{pm.display}" />
                        </bnu:selectOneMenu>
                    </bnu:column>
                    <bnu:column span="4" >
                        <bnu:inputText label="#{messages.lblReferenceNo}" onkeyup="soloNumeros(this);" maxlength="20" />
                    </bnu:column>
                </bnu:row>



                <p:separator/>
                <bnu:row class="messages" >
                    <bnu:column span="12" class="addCustSuccess" >
                        <bnu:messages />

                    </bnu:column>


                </bnu:row>
                <bnu:row>
                    <bnu:column span="6">
                        <h:panelGroup id="prods">
                            #{invoiceController.refreshCombo()}
                            <bnu:selectOneMenu label="#{messages.lblProductComplete}" value="#{invoiceController.idProd}" style="font-weight: bold"  >
                                <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                                <f:selectItems value="#{invoiceController.PList}" var="prod" 
                                               itemLabel="#{invoiceController.formatProdDisplay(prod)}" itemValue="#{prod.idProd}" />
                            </bnu:selectOneMenu>
                        </h:panelGroup>
                    </bnu:column>
                    <!--<bnu:column span="4">
                        <bnu:inputText label="Quantity"  onkeyup="soloNumeros(this)" maxlength="4" />
                        
                    </bnu:column>-->
                    <bnu:column span="2">
                        <bnu:button value="#{messages.lblNewProd}" look="warning" style="margin-top: 25px;width: 100%"  onclick="$('.modalPseudoClass').modal()" />
                    </bnu:column>
                    <bnu:column span="4">
                        <bnu:commandButton ajax="true" update="@(.lowSection)" value="#{messages.lblAddProductBundle}" look="success" style="margin-top: 25px;width: 100%" action="#{invoiceController.addDetail()}" />

                    </bnu:column>
                </bnu:row>

                <p:separator/>
                <bnu:row>
                    <bnu:column span="4">
                        <bnu:selectOneMenu  update="@(.lowSection)" value="#{invoiceController.hasTax}" onchange="ajax:invoiceController.updateTotal();" >
                            <f:selectItems value="#{invoiceController.invoiceTaxOptions}" var="option" itemLabel="#{option.label}" itemValue="#{option.bool}"/>
                           <!-- <f:selectItem itemLabel="#{messages.lblInvoiceWTax}" itemValue="true" />
                            <f:selectItem itemLabel="#{messages.lblInvoiceWTTax}" itemValue="false" />-->
                        </bnu:selectOneMenu>

                    </bnu:column>
                </bnu:row>
                <bnu:row>
                    <bnu:column span="12" class="lowSection" >
                        <bnu:dataTable
                            paginated="false"
                            searching="false"
                            responsive="true"
                            id="tblDetail"
                            value="#{invoiceController.DList}"
                            var="det">
                            <bnu:dataTableColumn label="#{messages.lblProductComplete}" value="#{det.itemName}" />
                            <bnu:dataTableColumn label="#{messages.lblSKU}" value="#{det.itemSku}" />
                            <bnu:dataTableColumn label="#{messages.lblDesc}" value="#{det.itemDesc}" />
                            <bnu:dataTableColumn label="#{messages.lblQuant}"  >
                                <bnu:inputText  value="#{det.itemQuant}"  tooltip="#{invoiceController.tooltipQuant(det.idProd,det.itemQuant)}" onkeyup="soloNumeros(this)" maxlength="4"   onblur="ajax:invoiceController.updateTotal();"  update="@(.lowSection)" />
                            </bnu:dataTableColumn>
                            <bnu:dataTableColumn label="#{messages.lblInDetRate}" value="#{det.itemRate}" />
                            <bnu:dataTableColumn label="#{messages.lblInDetAmount}" value="#{invoiceController.formatOutput(det.itemAmount)}" />
                            <bnu:dataTableColumn label="#{messages.lblInvoiceTax}" rendered="#{invoiceController.hasTax}" >
                                <bnu:selectOneMenu value="#{det.itemTax}" update="@(.lowSection)" onchange="ajax:invoiceController.updateTotal();" >
                                    <f:selectItems value="#{invoiceController.taxList}" var="tax" itemLabel="#{tax.name} (#{tax.rate}%)" itemValue="#{tax.idTax.toString()}" />
                                </bnu:selectOneMenu>
                            </bnu:dataTableColumn>
                            <bnu:dataTableColumn label="" >
                                <bnu:commandButton icon-awesome="fa-trash" value="" icon-size="lg" ajax="true" update="@(.lowSection)" action="#{invoiceController.removeDetail(det)}"  />
                            </bnu:dataTableColumn>
                        </bnu:dataTable>
                    </bnu:column>
                </bnu:row>
                <p:separator/>
                <bnu:row class="lowSection" >
                    <bnu:column span="7"/>
                    <bnu:column span="5">
                        <div class="form-group row">
                            <label class="col-form-label col-sm-8" >
                                #{messages.lblInvoiceSubTotal}
                            </label>
                            <div class="col-sm-4">
                                #{invoiceController.DSubTotal}
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-form-label col-sm-2" >
                                #{messages.lblInShipCost}
                            </label>
                            <div class="col-sm-6">
                                <bnu:selectOneMenu  class="form-control" value="#{invoiceController.shCostIdTax}" onchange="ajax:invoiceController.updateTotal();" update="@(.lowSection)" >
                                    <f:selectItem  itemLabel="#{messages.lblSelectShTax}" itemValue="0"  />
                                    <f:selectItems value="#{invoiceController.taxList}" var="tax" itemLabel="#{tax.name} (#{tax.rate}%)" itemValue="#{tax.idTax.toString()}" />
                                </bnu:selectOneMenu>
                            </div>
                            <div class="col-sm-4">
                                <bnu:inputText value="#{invoiceController.shCost}" maxlength="6"  onblur="ajax:invoiceController.updateTotal();"  update="@(.lowSection)" class="form-control" /> 
                            </div>


                        </div>



                        <div class="form-group row">
                            <label class="col-form-label col-sm-8" >
                                <h:panelGrid rendered="#{invoiceController.showShTax()}" >
                                    Shipping cost #{invoiceController.DShCostTaxName} of #{invoiceController.shCost}
                                </h:panelGrid>
                            </label>
                            <div class="col-sm-4">
                                <h:panelGrid rendered="#{invoiceController.showShTax()}" >
                                    #{invoiceController.DShCostTaxAmount}
                                </h:panelGrid>
                            </div>
                        </div>






                        <ui:repeat value="#{invoiceController.taxesAmountList}" var="it">
                            <div class="form-group row">
                                <label class="col-form-label col-sm-8" >
                                    #{it.idTax.name} #{it.idTax.rate}% #{messages.lblInTaxOf} #{invoiceController.formatOutput(it.fromAmount)}
                                </label>
                                <div class="col-sm-4">
                                    #{invoiceController.formatOutput(it.taxAmount)}
                                </div>
                            </div>
                        </ui:repeat>
                        <div class="form-group row">
                            <label class="col-form-label col-sm-8" >
                                #{messages.lblInvoiceTotal}
                            </label>
                            <div class="col-sm-4">
                                #{invoiceController.DTotal}
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:panelGroup rendered="#{invoiceController.showSegunType('CN')}" ><label class="col-form-label col-sm-8" >
                                    #{messages.lblTotalCredit}
                                </label></h:panelGroup>
                            <h:panelGroup rendered="#{invoiceController.showSegunType('IN')}" ><label class="col-form-label col-sm-8" >
                                    #{messages.lblInvoiceBalanceDue}
                                </label></h:panelGroup>
                            <h:panelGroup rendered="#{invoiceController.showSegunType('SR')}" ><label class="col-form-label col-sm-8" >
                                    #{messages.lblInvoiceBalanceDue}
                                </label></h:panelGroup>
                            <h:panelGroup rendered="#{invoiceController.showSegunType('ES')}" ><label class="col-form-label col-sm-8" >
                                    #{messages.lblEstimateTotal}
                                </label></h:panelGroup>
                            <div class="col-sm-4">
                                #{invoiceController.showBalanceDue()}
                            </div>
                        </div>
                        <p:separator/>
                    </bnu:column>
                </bnu:row> 



                <p:separator/>
            </bnu:container>

        </h:form>
        <!-- bottom navbar-->
        <bnu:navBar  inverse="true" position="bottom" fixed="true" >
            <h:panelGroup id="clear">
                <h:form styleClass="navbar-form navbar-left"  id="navBtn1" >
                    <bnu:commandButton value="Cancel" styleClass="btnBottom"  action="#{invoiceController.regresar()}" rendered="#{!invoiceController.formTouched}" />
                    <bnu:button value="Cancel" styleClass="btnBottom"  onclick="PF('dlg5').show();" rendered="#{invoiceController.formTouched}" />
                    <bnu:button value="Clear" style="margin-left: 10px" styleClass="btnBottom" onclick="PF('dlg6').show();"  rendered="#{invoiceController.formTouched}"  />
                </h:form>
            </h:panelGroup>
            <bnu:navbarLinks  >
                <bnu:navLink value="Preview" onclick="PF('dlg9').show();"  ></bnu:navLink>
                <bnu:navLink value="Delete" onclick="PF('dlg8').show();" rendered="#{invoiceController.modStay}"  ></bnu:navLink>
            </bnu:navbarLinks>
            <h:form styleClass="navbar-form navbar-right" >
                <bnu:commandButton value="#{messages.save}"  look="success"  style="width: 100%" action="#{invoiceController.save('A')}" rendered="#{!invoiceController.modStay}" update="@(.messages)"  />
                <bnu:commandButton value="#{messages.lblUpdateIn}"  look="success"  style="width: 100%"  action="#{invoiceController.save('U')}" rendered="#{invoiceController.modStay and  (not invoiceController.linked)}" update="@(.messages)" />
                <bnu:button value="#{messages.lblUpdateIn}"  look="success"  style="width: 100%"  onclick="PF('dlg7').show();" rendered="#{invoiceController.linked}" />
            </h:form>
        </bnu:navBar>

        <!-- fin navbar -->



        <!-- modal producto types y  add -->
        <bnu:modal id="amodal"   styleClass="modalPseudoClass" backdrop="false" closeOnEscape="false" 
                   closable="false" >
            <h:form id="prodForm">
                <h:panelGroup id="modalContent">
                    <h3>#{productController.modalTitle}</h3>
                    <ui:fragment rendered="#{!productController.showForm}">
                        <bnu:panel styleClass="typeOp" onclick="ajax:productController.selectType('IN', 'inv.png');" >
                            <bnu:row   >

                                <bnu:column tiny-screen="3" small-screen="2" medium-screen="2" large-screen="2">
                                    <p:graphicImage name="inv.png" library="img" width="64" height="64" />
                                </bnu:column>
                                <bnu:column tiny-screen="9" small-screen="10" medium-screen="10" large-screen="10">
                                    <p><strong>#{messages.lblInventory}</strong></p>
                                    <p>#{messages.lblInventoryDetail}</p>
                                </bnu:column>
                            </bnu:row>
                        </bnu:panel>
                        <p:separator/>
                        <bnu:panel styleClass="typeOp" onclick="ajax:productController.selectType('NI', 'noninv.png');" >
                            <bnu:row  >
                                <bnu:column tiny-screen="3" small-screen="2" medium-screen="2" large-screen="2">
                                    <p:graphicImage name="noninv.png" library="img" width="64" height="64" />
                                </bnu:column>
                                <bnu:column tiny-screen="9" small-screen="10" medium-screen="10" large-screen="10">
                                    <p><strong>#{messages.lblNonInventory}</strong></p>
                                    <p>#{messages.lblNonInventoryDetail}</p>
                                </bnu:column>
                            </bnu:row>   
                        </bnu:panel>
                        <p:separator/>
                        <bnu:panel styleClass="typeOp" onclick="ajax:productController.selectType('SE', 'serv.png');" >
                            <bnu:row  >
                                <bnu:column tiny-screen="3" small-screen="2" medium-screen="2" large-screen="2">
                                    <p:graphicImage name="serv.png" library="img" width="64" height="64" />
                                </bnu:column>
                                <bnu:column tiny-screen="9" small-screen="10" medium-screen="10" large-screen="10">
                                    <p><strong>#{messages.lblService}</strong></p>
                                    <p>#{messages.lblServiceDetail}</p>
                                </bnu:column>
                            </bnu:row>
                        </bnu:panel>
                        <p:separator/>

                        <bnu:panel styleClass="typeOp" onclick="ajax:productController.selectType('BU', 'bundle.png');" >
                            <bnu:row >
                                <bnu:column tiny-screen="3" small-screen="2" medium-screen="2" large-screen="2">
                                    <p:graphicImage name="bundle.png" library="img" width="64" height="64" />
                                </bnu:column>
                                <bnu:column tiny-screen="9" small-screen="10" medium-screen="10" large-screen="10">
                                    <p><strong>#{messages.lblBundle}</strong></p>
                                    <p>#{messages.lblBundleDetail}</p>
                                </bnu:column>
                            </bnu:row>
                        </bnu:panel>
                        <p:separator/>
                        <bnu:row>

                            <bnu:column span="6">
                                <bnu:button value="#{messages.lblClose}" look="danger" onclick="$('.modalPseudoClass').modal('hide')" size="lg"/>
                            </bnu:column>

                        </bnu:row>
                    </ui:fragment>

                    <ui:fragment rendered="#{productController.showForm}">

                        <bnu:row  >
                            <bnu:column tiny-screen="1" small-screen="1" medium-screen="1" large-screen="1" >
                                <p:graphicImage name="#{productController.typeImg}" library="img" width="32" height="32" />
                            </bnu:column>
                            <bnu:column tiny-screen="11" small-screen="11" medium-screen="11" large-screen="11">
                                <h6><strong>#{productController.convertType(productController.type)}</strong></h6>

                            </bnu:column>
                        </bnu:row> 
                        <p:separator/>
                        <bnu:row  >
                            <bnu:column tiny-screen="12" small-screen="12" medium-screen="8" large-screen="8">
                                <bnu:inputText label="#{messages.lblName}" maxlength="40" 
                                               placeholder="#{messages.lblProdName}" value="#{productController.name}"
                                               />
                                <bnu:inputText label="#{messages.lblSKU}" onkeyup="soloNumeros(this)"  maxlength="20" label-style="color:black;" placeholder="#{messages.lblSKU}" value="#{productController.sku}" />
                            </bnu:column>
                            <bnu:column tiny-screen="12" small-screen="12" medium-screen="4" large-screen="4" >
                                <p:graphicImage value="#{productController.photoUrl}" id="showPhoto" width="128" height="128" />
                            </bnu:column>
                        </bnu:row  >
                        <bnu:row>
                            <bnu:column span="12">
                                <h:outputLabel>#{messages.lblProdPhoto}</h:outputLabel>
                                <p:fileUpload label="#{messages['lblImageUpload']}" invalidFileMessage="#{messages['lblFileInvalid']}" id="logoCom" fileUploadListener="#{productController.handleFileUpload}" mode="advanced"
                                              auto="true" sizeLimit="#{userData.GParameters.imgBytesSize}" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
                            </bnu:column>
                        </bnu:row>
                        <bnu:row rendered="#{!productController.bundle}" >
                            <bnu:column span="6">
                                <bnu:selectOneMenu label="#{messages.lblCate}" value="#{productController.idCat}" >
                                    <f:selectItem itemValue="0" itemLabel="#{messages.selectOne}"  />
                                    <f:selectItems value="#{categoryController.list}" var="cat" itemValue="#{cat.idCat}" itemLabel="#{cat.name}" /> 
                                </bnu:selectOneMenu>


                            </bnu:column>
                            <bnu:column span="6"  rendered="#{productController.type eq 'IN'}" >
                                <bnu:inputText label="#{messages.lblInitQuant}"  maxlength="6" onkeyup="soloNumeros(this)" value="#{productController.initQuant}"  />
                            </bnu:column>

                        </bnu:row>


                        <p:separator/>
                        <bnu:row>
                            <bnu:column span="12">
                                <bnu:inputTextarea label="#{messages.lblDesc}"  maxlength="250" value="#{productController.desc}" />
                            </bnu:column>

                        </bnu:row>
                        <bnu:row rendered="#{!productController.bundle}">
                            <bnu:column span="6">
                                <bnu:inputText label="#{messages.lblPrice}" maxlength="10" value="#{productController.price}"/>
                            </bnu:column>
                            <bnu:column span="6">
                                <bnu:selectBooleanCheckbox label="#{messages.lblIncTax}"  value="#{productController.incTax}" />

                            </bnu:column>

                        </bnu:row>
                        <bnu:row rendered="#{!productController.bundle}">
                            <bnu:column span="6">
                                <bnu:selectOneMenu label="#{messages.lblTax}"  value="#{productController.idTax}" >
                                    <f:selectItem itemValue="0" itemLabel="#{messages.selectOne}" />
                                    <f:selectItems value="#{productController.TList}" var="tax" 
                                                   itemLabel="#{tax.name} (#{tax.rate}%)"
                                                   itemValue="#{tax.idTax}" />
                                </bnu:selectOneMenu>
                            </bnu:column>
                        </bnu:row>
                        <bnu:row  rendered="#{productController.bundle}">
                            <bnu:column span="6">
                                <bnu:selectOneMenu label="#{messages.lblProductComplete}" value="#{productController.productBundle}">
                                    <f:selectItems value="#{productController.itemBundleList}"
                                                   var="item" itemValue="#{item}"
                                                   itemLabel="#{item.name}" />
                                </bnu:selectOneMenu>
                            </bnu:column>
                            <bnu:column span="3">
                                <bnu:inputText label="#{messages.lblQuant}" value="#{productController.bundleQuant}" onkeyup="soloNumeros(this)" maxlength="4" id="bQuant" />
                            </bnu:column>
                            <bnu:column span="3">
                                <bnu:commandButton value="#{messages.lblAddProductBundle}" look="success" style="margin-top: 25px;" 
                                                   action="#{productController.addItemBundle()}" ajax="true" update="tblBundle"  />
                            </bnu:column>

                        </bnu:row>
                        <h:panelGroup id="tblBundle">
                            <bnu:row  rendered="#{productController.bundle}">
                                <bnu:column span="12">
                                    <bnu:dataTable
                                        value="#{productController.bundleItems}"
                                        searching="false"
                                        paginated="false"
                                        responsive="true"
                                        var="bi"
                                        >
                                        <bnu:dataTableColumn label="#{messages.lblProductComplete}"  value="#{bi.itemName}" />
                                        <bnu:dataTableColumn label="#{messages.lblPrice}"  value="#{productController.formatDouble(bi.itemPrice)}"/>
                                        <bnu:dataTableColumn label="#{messages.lblQuant}" value="#{bi.quant}" />
                                        <bnu:dataTableColumn label="#{messages.lblTotal}" value="#{bi.total}" />
                                        <bnu:dataTableColumn label="#{messages.lblAction}">
                                            <bnu:commandButton icon-awesome="fa-trash" value="" icon-size="lg" ajax="true" action="#{productController.removeItemBundle(bi)}" />

                                        </bnu:dataTableColumn>
                                    </bnu:dataTable>
                                </bnu:column>

                            </bnu:row>
                            <bnu:row  rendered="#{productController.bundle}">
                                <bnu:column span="10">
                                    <h:outputText value="#{messages.lblTotal}" style="font-weight: bold;" />
                                </bnu:column>
                                <bnu:column span="2">
                                    <h:outputText value="#{productController.bundleTotal}" />
                                </bnu:column>
                            </bnu:row>
                        </h:panelGroup>
                        <p:separator/>
                        <bnu:row>
                            <bnu:column span="12">
                                <bnu:messages id="msg" />
                            </bnu:column>
                        </bnu:row>
                        <bnu:row>
                            <bnu:column span="6">
                                <bnu:commandButton value="#{messages.save}" style="width: 100%" look="success" 
                                                   action="#{productController.addNew(false)}" update="@form"
                                                   rendered="#{!productController.bundle}"
                                                   />
                                <bnu:commandButton value="#{messages.save}" style="width: 100%" look="success" 
                                                   action="#{productController.addBundle(false)}" update="@form"
                                                   rendered="#{productController.bundle}"
                                                   />
                            </bnu:column>
                            <bnu:column span="6">
                                <bnu:commandButton value="#{messages.lblClose}" look="danger" action="#{productController.limpiar()}" style="width: 100%"/>
                            </bnu:column>

                        </bnu:row>



                    </ui:fragment>
                </h:panelGroup>
            </h:form>
        </bnu:modal>

        <!-- fin modal productos -->

        <!--  modal add cliente -->
       <!--Modal add-->
                                  <h:form id="customerFormAdd" >
                    <bnu:modal id="amodal2" styleClass="addCustModal" size="modal-lg" title="#{messages.lblCustomerInfo}" >
                        <bnu:row class="addCustSuccess" >
                            <bnu:column span="1" >
                                <label>#{messages.titleC}</label>
                                <bnu:inputText type="text" size="3" value="#{invoiceController.customer.title}"  class="title" name="title" onblur="customerFormHelper.displayName();" maxlength="4"   />
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.fNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{invoiceController.customer.firstname}" class="fname" name="fname"  onblur="customerFormHelper.displayName();" maxlength="10"  />
                                
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.midNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{invoiceController.customer.middlename}" class="mname" name="mname" onblur="customerFormHelper.displayName();" maxlength="10"    />
                                
                            </bnu:column>
                            <bnu:column span="2" >
                                <label>#{messages.lastNameC}</label>
                                <bnu:inputText type="text" size="10" value="#{invoiceController.customer.lastname}" class="lname" name="lname" onblur="customerFormHelper.displayName();" maxlength="15"  />
                                
                            </bnu:column>
                            <bnu:column span="1" >
                                <label>#{messages.suffixC}</label>
                                <bnu:inputText type="text" size="3" value="#{invoiceController.customer.suffixx}" class="suffix" name="suffix" onblur="customerFormHelper.displayName();" maxlength="10"  />
                                
                            </bnu:column>
                            <bnu:column span="4" >
                                <bnu:inputText label="#{messages.email}" value="#{invoiceController.customer.email}" field-size="xs" maxlength="50"  />

                            </bnu:column>
                        </bnu:row>

                        <bnu:row class="addCustSuccess" >

                            <bnu:column span="6" >
                                <bnu:inputText label="#{messages.companyC}" value="#{invoiceController.customer.company}" field-size="xs" maxlength="50"  />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.phoneC}" value="#{invoiceController.customer.phone}" field-size="xs" maxlength="10"  />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.mobileC}" value="#{invoiceController.customer.mobile}" field-size="xs" maxlength="10"  />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.faxC}" value="#{invoiceController.customer.fax}" field-size="xs" maxlength="10"  />

                            </bnu:column>
                        </bnu:row>

                        <bnu:row class="addCustSuccess" >


                            <bnu:column span="6" >
                                <label>#{messages.displayN}</label>
                                <bnu:inputText type="text" class="displayName"  field-size="xs" value="#{invoiceController.customer.displayName}" maxlength="60" />
                            </bnu:column>
                            <bnu:column span="2" >
                                <bnu:inputText label="#{messages.Otros}" field-size="xs"    />
                            </bnu:column>
                            <bnu:column span="4" >
                                <bnu:inputText label="#{messages.website}" field-size="xs" value="#{invoiceController.customer.webside}" maxlength="20"  />

                            </bnu:column>
                        </bnu:row>


                        <bnu:tabView  activeIndex="0" >
                            <bnu:tab title="#{messages.lblAddress}" >
                                <bnu:row  >
                                    <bnu:column span="6" class="addCustSuccess" >
                                        <bnu:row>
                                            <bnu:column span="12">
                                                <label>#{messages.billingA}</label>
                                                <bnu:inputTextarea  placeholder="#{messages.streetC}" class="form-control"  value="#{invoiceController.customer.street}" maxlength="150" />
                                            </bnu:column>
                                        </bnu:row>

                                        <bnu:row>
                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.cityT}"  value="#{invoiceController.customer.city}" maxlength="20"  />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.stateP}"  value="#{invoiceController.customer.estate}" maxlength="20"  />
                                            </bnu:column>

                                        </bnu:row>

                                        <bnu:row>
                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.postalCC}"  value="#{invoiceController.customer.postalCode}" maxlength="15"  />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.countryC}" value="#{invoiceController.customer.country}" maxlength="20"  />
                                            </bnu:column>

                                        </bnu:row>

                                    </bnu:column>
                               
                                    <bnu:column span="6" >
                                        <bnu:row>
                                            <bnu:column span="12">
                                                <label>#{messages.shippingA}</label> <input checked="true" type="checkbox" onclick="customerFormHelper.enableShipAdress()" value="1"  name="sameSha" id="sameSha" />#{messages.sameSHA}
                                                <h:panelGroup class="addCustSuccess"> <bnu:inputTextarea placeholder="#{messages.streetC}"  class="form-control shippingEnable"  value="#{invoiceController.customer.streetS}" maxlength="150"   /></h:panelGroup>
                                            </bnu:column>
                                        </bnu:row>
                                        <bnu:row class="addCustSuccess" >

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.cityT}"  class="shippingEnable" value="#{invoiceController.customer.cityS}" maxlength="20" />
                                            </bnu:column>

                                            <bnu:column span="6">
                                                <bnu:inputText placeholder="#{messages.stateP}"  class="shippingEnable" value="#{invoiceController.customer.estateS}" maxlength="20" />
                                            </bnu:column>
                                        </bnu:row>
                                        <bnu:row class="addCustSuccess" >

                                    <bnu:column span="6">
                                        <bnu:inputText placeholder="#{messages.postalCC}"  class="shippingEnable" value="#{invoiceController.customer.postalCodeS}" maxlength="15" />
                                    </bnu:column>

                                    <bnu:column span="6">
                                        <bnu:inputText placeholder="#{messages.countryC}"  class="shippingEnable" value="#{invoiceController.customer.countryS}" maxlength="20" />
                                    </bnu:column>
                                </bnu:row>
                                    </bnu:column>

                                
                                

                                </bnu:row>


                            </bnu:tab>
                            <bnu:tab title="#{messages.lblCustNotes }"  >
                                <bnu:row class="addCustSuccess" >
                                    <bnu:column span="12">
                                        <bnu:inputTextarea label="#{messages.lblCustNotes }"  value="#{invoiceController.customer.note}" maxlength="200"  />
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.taxInfo}" >
                                <bnu:row class="addCustSuccess" >
                                    <bnu:column span="4">
                                        <bnu:inputText label="#{messages.lblTaxRegNo}"  value="#{invoiceController.customer.taxregno}" maxlength="15"   />
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.lblPaymentAndBilling}" >
                                <bnu:row class="addCustSuccess" >
                                    <bnu:column span="4"   >
                                        <bnu:selectOneMenu label="#{messages.lblPreferredPayment}" value="#{invoiceController.customer.paymentMethod}" >
                                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue=""  />
                                            <f:selectItems value="#{invoiceController.PMethodList}" var="pm"
                                           itemValue="#{pm.display}" itemLabel="#{pm.display}" />   
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                    <bnu:column span="4"></bnu:column>
                                    <bnu:column span="4"   >
                                        <bnu:selectOneMenu label="#{messages.lblInvoiceTerms}"    value="#{invoiceController.customer.terms}" >
                                            <f:selectItem  itemLabel="#{messages.selectOne}" itemValue="0"  />
                                            <f:selectItems value="#{invoiceController.TList}" var="term"
                                               itemLabel="#{term.display}" itemValue="#{term.days}" />
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                </bnu:row>
                                <bnu:row class="addCustSuccess" >
                                    <bnu:column span="4"  >
                                        <bnu:selectOneMenu label="#{messages.lblPrefDelivery}" value="#{invoiceController.customer.deliveryMethod}" >
                                            <f:selectItem  itemLabel="#{messages.lblNone}" itemValue="#{messages.lblNone}"  />
                                            <f:selectItem  itemLabel="#{messages.lblSendLater}" itemValue="#{messages.lblSendLater}"  />
                                            <f:selectItem  itemLabel="#{messages.lblPrintLater}" itemValue="#{messages.lblPrintLater}"  />
                                        </bnu:selectOneMenu>
                                    </bnu:column>
                                    <bnu:column span="2"></bnu:column>
                                    <bnu:column span="2"  >
                                        <bnu:inputText  label="#{messages.lblOpeningBalance}"  value="#{invoiceController.customer.balance}" maxlength="6"  />
                                    </bnu:column>
                                    <bnu:column span="4"   > <label>#{messages.lblAsOf}</label><bnu:inputText type="date" disabled="true" value="#{invoiceController.customer.asOf}" maxlength="10"  /></bnu:column>
                                </bnu:row>
                            </bnu:tab>
                            <bnu:tab title="#{messages.lblAttachments}" >
                                <bnu:row>
                                    <bnu:column  span="4">
                                        <p:fileUpload />
                                    </bnu:column>
                                    <bnu:column  span="4">
                                        #{messages.lblMaximumSize}
                                    </bnu:column>
                                </bnu:row>
                            </bnu:tab>


                        </bnu:tabView>
                        <bnu:row>
                            <bnu:column span="12" class="addCustSuccess" >
                                <bnu:messages id="errorMessage"  />
                            </bnu:column>
                        </bnu:row>

                        <f:facet name="footer">
                            <bnu:button value="Close" dismiss="modal"  />
                            <bnu:commandButton value="#{messages.save}" look="success" update="@(.addCustSuccess)" action="#{invoiceController.registerC()}"  />
                        </f:facet>
                    </bnu:modal>
                </h:form>

        <!-- fin modal add cliente -->


        <!-- modal confirm exit -->
        <p:dialog header="Confirmation" widgetVar="dlg5" modal="true" height="100">
            <h:outputText value="Do you want to leave without saving?" /><br/>
            <p:separator />

            <h:form id="confirmModal">
                <bnu:button value="No" onclick="PF('dlg5').hide();" />
                <bnu:commandButton value="Yes" look="success" action="#{invoiceController.regresar()}" style="margin-left: 10px" />
            </h:form>
        </p:dialog> 


        <p:dialog header="Confirmation" widgetVar="dlg6" modal="true" height="100">
            <h:outputText value="Are you sure you want to clear this transaction?" /><br/>
            <p:separator />

            <h:form id="confirmModalReset">
                <bnu:button value="No" onclick="PF('dlg6').hide();" />
                <bnu:commandButton value="Yes" look="success" action="#{invoiceController.validationBean.redirecionar('/view/sales/invoiceForm.xhtml')}" style="margin-left: 10px"  />
            </h:form>
        </p:dialog> 

        <p:dialog header="Confirmation" widgetVar="dlg7" modal="true" height="100">
            <h:outputText value="This transaction is linked to payments, are you sure that you want to save? saving would update all the linked payments" /><br/>
            <p:separator />

            <h:form id="confirmModalSaveLink">
                <bnu:button value="No" onclick="PF('dlg7').hide();" />

                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{invoiceController.save('U')}" rendered="#{invoiceController.modStay}" update="@(.messages)" />

            </h:form>
        </p:dialog>

        <p:dialog header="Confirmation" widgetVar="dlg8" modal="true" height="150">
            <bnu:alert severity="danger">
                <h:outputText value="Are you sure you want to delete this?" />
            </bnu:alert>

            <p:separator />

            <h:form id="confirmModalDelete">
                <bnu:button value="No" onclick="PF('dlg8').hide();" />

                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{invoiceController.save('D')}" />

            </h:form>
        </p:dialog>



        <p:dialog header="Confirmation" widgetVar="dlg9" modal="true" height="150">
            <bnu:alert severity="info">
                <h:outputText value="If you want to print or preview, the transaction will be saved, are you sure?" />
            </bnu:alert>

            <p:separator />

            <h:form id="confirmModalPreview">
                <bnu:button value="No" onclick="PF('dlg9').hide();" />

                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{invoiceController.saveForPrint('A')}" rendered="#{!invoiceController.modStay}" update="@(.messages)"  />
                <bnu:commandButton value="Yes"  look="success"  style="margin-left: 10px" action="#{invoiceController.saveForPrint('U')}" rendered="#{invoiceController.modStay}"   />
            </h:form>
        </p:dialog>    

        <!-- end modal exit-->


        <!-- PDF MODAL-->
        <bnu:modal  id="invoiceModal" title="#{messages.invoice}" styleClass="invoiceModal"  close-on-escape="false" backdrop="false"  >
            <h:panelGroup id="pdf" class="messages" >

                <p:media value="#{invoiceController.invoiceModal}" width="100%" height="500px" rendered="#{not(invoiceController.invoiceModal eq '0')}"  />     


            </h:panelGroup>
        </bnu:modal> 




        <!--FIN PDF MODAL-->


        <h:outputScript>
            function soloNumeros(obj) 
            { 
            obj.value = (obj.value + '').replace(/[^0-9]/g, '');
            }
            //$.blockUI({ message: 'Hold on!' });      
            function mensaje(e){
            alert(e);
            } 


            function show(value){

            if(value == "PE"){
            $(".updateEstimateStatus").hide();
            //alert(value);
            }else{
            $(".updateEstimateStatus").show();
            //alert(value);
            }
            }

            function myFunction() {
            $(".dropdown-content").show();
            };            

            $(document).on("click",function(event) {

            var str = $(event.target).parent().parent().parent().attr('class')+' '+$(event.target).parent().parent().attr('class')+' '+$(event.target).parent().attr('class') + ' ' + $(event.target).attr('class');
            //alert(str.indexOf("dropLi")>=0);
            if(str.indexOf("dropLi")>=0){


            }else{
            //alert(str);
            $(".dropdown-content").hide();
            }



            });

        </h:outputScript>
        
          <h:outputScript>
      
                    
                    var customerFormHelper = {
                    shippingDir : 1,
                    displayName: function(){
                    var title = $(".title").val() + ' ';
                    var fname = $(".fname").val() + ' ';
                    var mname = $(".mname").val() + ' ';
                    var lname = $(".lname").val() + ' ';
                    var suffix = $(".suffix").val();
                    $(".displayName").val(title + fname +mname + lname + suffix);
                    },
                    enableShipAdress: function (){
                    if(this.shippingDir == 1){
                    $(".shippingEnable").removeAttr('disabled');

                    this.shippingDir = 2;
                    }else{
                    $(".shippingEnable").attr('disabled',true);
                    $(".shippingEnable").val("");
                    this.shippingDir = 1;
                    }
                    }
                    };
                    

                    $(document).ready(function(){
                        $(".shippingEnable").attr('disabled',true);
                        
                    });
                    
                </h:outputScript>

        <style>
            body{
                background-color: #ccffff;
            }
            .marco{
                background-color: #ffffff;
            }

            .btnBottom{
                background-color: black;
                color: white;

            }

            .btnBottom:hover{
                background-color: #666666;

            }

            .dropdown-content {
                display: none;
                position: absolute;
                background-color: #f1f1f1;
                min-width: 300px;
                overflow: auto;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 1;
                padding: 10px;
                border: 1px solid #ddd;
            }
        </style>
           <style type="text/css">
        .typeOp{

            cursor: pointer;
        }
        .typeOp:hover{
            background-color: #dedeee;
            border-radius: 100px;
        }
    </style>

        <!-- <h:outputStylesheet>
              body{
                 background-color: #20b2aa;
             }
         </h:outputStylesheet>-->
    </h:body>
</html>

